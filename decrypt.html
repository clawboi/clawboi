<!-- decrypt.html -->
<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>DECRYPT</title>
<style>
:root{--bg:#000;--violet:#8a2eff;--fg:#fff;}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  background:var(--bg);
  color:var(--fg);
  font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
  overflow:hidden;
}
a{color:#fff;text-decoration:none}
.brand{
  position:fixed;top:14px;left:14px;z-index:9;
  font-size:11px;letter-spacing:.34em;text-transform:uppercase;
  opacity:.75;text-shadow:0 0 18px rgba(138,46,255,.25);
}
.brand:hover{opacity:1}
.hud{
  position:fixed;top:14px;right:14px;z-index:9;
  font-size:10px;letter-spacing:.30em;text-transform:uppercase;
  opacity:.62;
}
.panel{
  position:fixed;
  left:14px; bottom:14px;
  z-index:9;
  width:min(520px, calc(100vw - 28px));
  background:rgba(255,255,255,.03);
  border-radius:16px;
  padding:14px;
  backdrop-filter: blur(10px);
  box-shadow:0 0 38px rgba(138,46,255,.10);
}
.panel .title{
  font-size:10px;letter-spacing:.34em;text-transform:uppercase;opacity:.75;
}
.files{
  margin-top:10px;
  font-size:12px;
  line-height:1.6;
  letter-spacing:.08em;
  opacity:.85;
}
.file{
  display:flex;
  justify-content:space-between;
  gap:10px;
  padding:8px 10px;
  border-radius:12px;
  background:rgba(138,46,255,.06);
  margin-top:8px;
  cursor:pointer;
}
.file:hover{filter:brightness(1.06)}
.file .name{opacity:.92}
.file .tag{opacity:.55; letter-spacing:.22em; text-transform:uppercase; font-size:10px}
.small{
  margin-top:10px;
  font-size:10px;
  letter-spacing:.30em;
  text-transform:uppercase;
  opacity:.55;
}

/* NEW: mini player + visualizer */
.player{
  margin-top:12px;
  display:flex;
  gap:10px;
  align-items:center;
  flex-wrap:wrap;
}
.pbtn{
  appearance:none;
  border:0;
  cursor:pointer;
  padding:10px 12px;
  border-radius:999px;
  background:rgba(138,46,255,.16);
  color:#fff;
  letter-spacing:.22em;
  font-size:10px;
  text-transform:uppercase;
}
.pbtn:hover{filter:brightness(1.06)}
.pbtn.alt{background:rgba(255,255,255,.06)}
.viz{
  width:100%;
  height:46px;
  border-radius:12px;
  overflow:hidden;
  background:rgba(255,255,255,.02);
  box-shadow: inset 0 0 0 1px rgba(255,255,255,.04);
}

/* small player hint */
.pnote{
  margin-top:8px;
  font-size:10px;
  letter-spacing:.30em;
  text-transform:uppercase;
  opacity:.5;
}

canvas{position:fixed;inset:0}
.scan{
  position:fixed;inset:0;pointer-events:none;z-index:3;
  opacity:.08;mix-blend-mode:overlay;
  background:repeating-linear-gradient(to bottom, rgba(255,255,255,.06) 0px, rgba(255,255,255,.06) 1px, transparent 3px, transparent 6px);
}
</style>
</head>
<body>

<a class="brand" href="vault.html">CLAWBOI</a>
<div class="hud" id="hud">DECRYPTING…</div>
<canvas id="c"></canvas>
<div class="scan"></div>

<div class="panel">
  <div class="title">LOST SONG FILES</div>

  <div class="files" id="files">
    <div class="file" data-song="backdoor">
      <div class="name">UNTITLED_03_BACKDOOR.wav</div>
      <div class="tag">RECOVER</div>
    </div>
    <div class="file" data-song="untitled01">
      <div class="name">UNTITLED_01.wav</div>
      <div class="tag">BROKEN</div>
    </div>
    <div class="file" data-song="untitled02">
      <div class="name">UNTITLED_02.wav</div>
      <div class="tag">GLITCH</div>
    </div>
    <div class="file" data-song="untitled04">
      <div class="name">UNTITLED_04.wav</div>
      <div class="tag">MISSING</div>
    </div>
  </div>

  <div class="small">YOU’LL PLUG REAL TRACKS IN LATER. CLICK A FILE TO “OPEN”.</div>

  <!-- NEW: audio + bouncing visual effect over the matrix -->
  <div class="player">
    <button class="pbtn" id="playAmb">PLAY AMBIENT</button>
    <button class="pbtn alt" id="stopAmb">STOP</button>
    <a class="pbtn alt" href="secret.html">RETURN TO TRANSMISSION</a>

    <!-- hidden audio element (swap src later if you want) -->
    <audio id="amb" preload="auto" loop>
      <!-- put your actual ambient file here later -->
      <source src="audio/ambient-space.mp3?v=1" type="audio/mpeg">
    </audio>

    <canvas class="viz" id="viz" aria-hidden="true"></canvas>
  </div>
  <div class="pnote">TIP: IF AUDIO DOESN’T START, TAP PLAY AGAIN.</div>
</div>

<script>
/* Matrix rain */
const c = document.getElementById("c");
const ctx = c.getContext("2d");
let w,h,cols,ys,font=16;

function resize(){
  w=c.width=window.innerWidth*devicePixelRatio;
  h=c.height=window.innerHeight*devicePixelRatio;
  ctx.setTransform(1,0,0,1,0,0);
  ctx.scale(devicePixelRatio,devicePixelRatio);
  cols = Math.floor(window.innerWidth / font);
  ys = Array(cols).fill(0).map(()=>Math.random()*window.innerHeight);
}
window.addEventListener("resize", resize);
resize();

/* --- NEW: audio-reactive bounce (no change to your 0/1 vibe, just motion + pulse) --- */
let aCtx, analyser, srcNode, data, playing=false;
let amp = 0; // smoothed amplitude 0..1

function setupAudio(){
  if(aCtx) return;
  aCtx = new (window.AudioContext || window.webkitAudioContext)();
  analyser = aCtx.createAnalyser();
  analyser.fftSize = 1024;
  data = new Uint8Array(analyser.frequencyBinCount);

  const audioEl = document.getElementById("amb");
  srcNode = aCtx.createMediaElementSource(audioEl);

  const gain = aCtx.createGain();
  gain.gain.value = 0.9;

  srcNode.connect(analyser);
  analyser.connect(gain);
  gain.connect(aCtx.destination);
}

function getAmp(){
  if(!analyser) return 0;
  analyser.getByteFrequencyData(data);
  // use low-mid bands for pulse
  let sum=0;
  const start=2, end=Math.min(48, data.length);
  for(let i=start;i<end;i++) sum += data[i];
  const avg = sum / (end-start) / 255; // 0..1
  // smooth it
  amp = amp*0.85 + avg*0.15;
  return amp;
}

/* HUD flicker */
const hud = document.getElementById("hud");
const hudLines = ["DECRYPTING…","PACKETS LOST…","REBUILDING INDEX…","SIGNAL FOUND.","OPEN A FILE."];
let hi=0;
setInterval(()=>{hi=(hi+1)%hudLines.length; hud.textContent=hudLines[hi];}, 1100);

/* Visualizer canvas (bounces to music) */
const viz = document.getElementById("viz");
const vctx = viz.getContext("2d");
function fitViz(){
  const dpr = Math.max(1, window.devicePixelRatio || 1);
  viz.width = Math.floor(viz.clientWidth * dpr);
  viz.height = Math.floor(viz.clientHeight * dpr);
  vctx.setTransform(1,0,0,1,0,0);
  vctx.scale(dpr,dpr);
}
addEventListener("resize", fitViz);
fitViz();

function drawViz(){
  const W = viz.clientWidth;
  const H = viz.clientHeight;
  vctx.clearRect(0,0,W,H);

  const level = getAmp();
  const bars = 32;
  const gap = 3;
  const bw = (W - gap*(bars-1)) / bars;

  for(let i=0;i<bars;i++){
    const idx = analyser ? Math.min(data.length-1, Math.floor(i*(data.length/bars))) : i;
    const raw = analyser ? (data[idx]/255) : 0;
    const h = Math.max(2, (raw*0.65 + level*0.35) * (H-6));
    const x = i*(bw+gap);
    const y = H - h;

    // white core + violet glow
    vctx.fillStyle = `rgba(255,255,255,${0.18 + raw*0.35})`;
    vctx.fillRect(x, y, bw, h);

    vctx.fillStyle = `rgba(138,46,255,${0.10 + raw*0.40})`;
    vctx.fillRect(x, y, bw, h*0.92);
  }

  requestAnimationFrame(drawViz);
}
drawViz();

/* Matrix tick now reacts to audio: speed + brightness + subtle “bounce” */
function tick(){
  const level = getAmp();

  // background fade gets a tiny bit stronger on hits
  const fade = 0.08 + level*0.08;
  ctx.fillStyle = `rgba(0,0,0,${fade})`;
  ctx.fillRect(0,0,window.innerWidth,window.innerHeight);

  // violet intensity bumps with level
  const a = 0.78 + level*0.22;
  ctx.fillStyle = `rgba(138,46,255,${a})`;
  ctx.font = font+"px ui-monospace, Menlo, monospace";

  // speed up slightly with amplitude
  const speed = 1 + level*2.4;

  for(let i=0;i<cols;i++){
    const x=i*font;
    const y=ys[i];
    const ch = Math.random() > 0.5 ? "0" : "1";

    // slight horizontal “wobble” from level
    const wobble = Math.sin((i*0.7) + performance.now()*0.002) * (level*3.5);
    ctx.fillText(ch, x + wobble, y);

    ys[i] = y + font*speed;
    if(ys[i] > window.innerHeight + Math.random()*400) ys[i]= -Math.random()*200;
  }
  requestAnimationFrame(tick);
}
tick();

/* Audio controls */
const playBtn = document.getElementById("playAmb");
const stopBtn = document.getElementById("stopAmb");
const amb = document.getElementById("amb");

playBtn.onclick = async ()=>{
  try{
    setupAudio();
    if(aCtx.state === "suspended") await aCtx.resume();
    await amb.play();
    playing = true;
    playBtn.textContent = "PLAYING";
  }catch(e){
    // silent fail like your style
  }
};

stopBtn.onclick = ()=>{
  amb.pause();
  amb.currentTime = 0;
  playing = false;
  playBtn.textContent = "PLAY AMBIENT";
};

/* File click behavior: goes to placeholders you can swap later */
document.getElementById("files").addEventListener("click",(e)=>{
  const row = e.target.closest(".file");
  if(!row) return;
  const key = row.getAttribute("data-song");
  if(key === "backdoor"){
    window.location.href = "backdoor.html";
  }else{
    window.location.href = "lostfile.html";
  }
});
</script>
</body>
</html>
