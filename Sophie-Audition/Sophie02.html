<!-- Sophie02.html (BACKYARD / GNOME + MUSHROOM FIELD) -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SOPHIE / AUDITION ‚Äî Backyard (Sophie02)</title>
  <meta name="theme-color" content="#06070c" />
  <style>
    :root{
      --bg:#06070c;
      --ink:#f2f2ff;
      --muted:rgba(242,242,255,.72);
      --hair:rgba(255,255,255,.10);
      --violet:#8A2EFF;
    }
    html,body{height:100%;margin:0;background:radial-gradient(900px 650px at 55% 35%, #111a2b 0%, #06070c 55%, #05040a 100%);overflow:hidden;font-family:ui-monospace, Menlo, Consolas, monospace;color:var(--ink)}
    canvas{position:fixed;inset:0;display:block}
    .hud{position:fixed;left:14px;top:12px;z-index:10;display:flex;gap:10px;flex-wrap:wrap;user-select:none}
    .pill{border:1px solid var(--hair);background:rgba(0,0,0,.35);backdrop-filter: blur(8px);border-radius:999px;padding:8px 10px;font-size:12px;letter-spacing:.12em;text-transform:uppercase;display:flex;gap:10px;align-items:center;box-shadow:0 0 20px rgba(138,46,255,.14)}
    .dot{width:8px;height:8px;border-radius:50%;background:var(--violet);box-shadow:0 0 14px rgba(138,46,255,.9)}
    .tip{position:fixed;right:14px;top:12px;z-index:10;width:min(420px, calc(100vw - 28px));border:1px solid var(--hair);background:rgba(0,0,0,.35);backdrop-filter: blur(8px);border-radius:16px;padding:10px 12px;font-size:12px;color:var(--muted)}
    .centerToast{position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);z-index:20;pointer-events:none;opacity:0;transition:.25s;border:1px solid var(--hair);background:rgba(0,0,0,.45);backdrop-filter: blur(10px);border-radius:18px;padding:12px 14px;max-width:min(520px, calc(100vw - 36px));text-align:center;line-height:1.35;box-shadow:0 0 36px rgba(138,46,255,.12)}
    .centerToast.show{opacity:1}
    .kbd{display:inline-block;padding:2px 6px;border-radius:8px;border:1px solid var(--hair);background:rgba(255,255,255,.06);color:var(--ink);font-size:11px}
  </style>
</head>
<body>
<canvas id="c"></canvas>

<div class="hud">
  <div class="pill"><span class="dot"></span><b>SOPHIE02</b><span>BACKYARD</span></div>
  <div class="pill">Key: <span id="keyState">NO</span></div>
</div>

<div class="tip" id="tip">
  <b>Backyard</b> is a quiet spell: hammock breeze, mushrooms that whisper trouble, and a garden gnome that hoards secrets.
  <div style="margin-top:6px">
    Interact <span class="kbd">E</span> ¬∑ Dance <span class="kbd">Z</span> ¬∑ Jump <span class="kbd">Space</span> ¬∑ Splits <span class="kbd">X</span> ¬∑ Hide tips <span class="kbd">H</span>
  </div>
</div>

<div class="centerToast" id="toast"></div>

<script>
(() => {
  const STORE_KEY = "SOPHIA_AUDITION_SAVE_V1";
  const defaultSave = { outfit:"violet", hasFrontDoorKey:false, lastRoom:"Sophie02.html" };
  const loadSave = () => { try{ const raw=localStorage.getItem(STORE_KEY); return raw ? {...defaultSave, ...JSON.parse(raw)} : {...defaultSave}; }catch(e){ return {...defaultSave}; } };
  const save = loadSave();
  const commitSave = () => { save.lastRoom="Sophie02.html"; localStorage.setItem(STORE_KEY, JSON.stringify(save)); keyState.textContent = save.hasFrontDoorKey ? "YES" : "NO"; };
  const keyState = document.getElementById("keyState");
  const tip = document.getElementById("tip");
  const toast = document.getElementById("toast");
  function showToast(html, ms=1400){ toast.innerHTML=html; toast.classList.add("show"); clearTimeout(showToast._t); showToast._t=setTimeout(()=>toast.classList.remove("show"), ms); }
  function go(href){ commitSave(); location.href = href; }

  const canvas = document.getElementById("c");
  const ctx = canvas.getContext("2d");
  const DPR = Math.min(2, devicePixelRatio||1);
  function resize(){ canvas.width=Math.floor(innerWidth*DPR); canvas.height=Math.floor(innerHeight*DPR); canvas.style.width=innerWidth+"px"; canvas.style.height=innerHeight+"px"; ctx.setTransform(DPR,0,0,DPR,0,0); }
  addEventListener("resize", resize, {passive:true}); resize();

  const keys = new Set();
  addEventListener("keydown", (e)=>{
    const k=e.key.toLowerCase(); keys.add(k);
    if(["arrowup","arrowdown","arrowleft","arrowright"," "].includes(e.key)) e.preventDefault();
    if(k==="h") tip.style.display = (tip.style.display==="none") ? "" : "none";
    if(k==="z") player.dancing=!player.dancing;
    if(k==="x") player.splitsT=0.6;
    if(e.key===" ") player.jumpT=Math.max(player.jumpT,0.35);
    if(k==="e") tryInteract();
  }, {passive:false});
  addEventListener("keyup",(e)=>keys.delete(e.key.toLowerCase()),{passive:true});
  const down = (k)=>keys.has(k);
  const axis = ()=> {
    const left=down("a")||down("arrowleft");
    const right=down("d")||down("arrowright");
    const up=down("w")||down("arrowup");
    const dn=down("s")||down("arrowdown");
    return {x:(right?1:0)-(left?1:0), y:(dn?1:0)-(up?1:0)};
  };

  const world = {
    w: 1400,
    h: 900,
    solids: [
      // hammock zone support posts (simple)
      {x: 160, y: 180, w: 140, h: 110, label:"Hammock", action: () => go("hammock.html")},
      // ping pong table
      {x: 980, y: 560, w: 220, h: 140, label:"Ping Pong", action: () => go("pingpong.html")},
      // mushroom field blocker (still interactable)
      {x: 520, y: 560, w: 340, h: 220, label:"Mushroom Field", action: eatMushroom},
      // shrubs
      {x: 1150, y: 140, w: 160, h: 160},
      {x: 60, y: 680, w: 200, h: 160},
    ],
    doors: [
      {x: 70, y: 380, w: 120, h: 140, label:"Back Inside", hint:"Bedroom (Sophie01.html)", action: () => go("Sophie01.html")}
    ],
    npcs: [
      {x: 1080, y: 260, r: 18, label:"Garden Gnome", hint:"Trade a secret for a key", action: gnomeKey}
    ]
  };

  const player = { x: 420, y: 420, r: 18, vx:0, vy:0, facing:{x:1,y:0}, dancing:false, jumpT:0, splitsT:0 };
  const milo = { x: player.x-40, y: player.y+30, r: 14, purr:0 };

  const cam = {x:0,y:0};
  const clamp=(v,a,b)=>Math.max(a,Math.min(b,v));
  function collideCircleRect(cx,cy,cr, rx,ry,rw,rh){
    const px=clamp(cx,rx,rx+rw), py=clamp(cy,ry,ry+rh);
    const dx=cx-px, dy=cy-py;
    return (dx*dx+dy*dy) < cr*cr;
  }
  function resolveSolids(ent){
    ent.x = clamp(ent.x, ent.r, world.w-ent.r);
    ent.y = clamp(ent.y, ent.r, world.h-ent.r);
    for(const s of world.solids){
      if(collideCircleRect(ent.x,ent.y,ent.r, s.x,s.y,s.w,s.h)){
        const left=ent.x-s.x, right=(s.x+s.w)-ent.x, top=ent.y-s.y, bottom=(s.y+s.h)-ent.y;
        const minX=Math.min(left,right), minY=Math.min(top,bottom);
        if(minX<minY) ent.x += (left<right)?-(ent.r):(ent.r);
        else ent.y += (top<bottom)?-(ent.r):(ent.r);
        ent.x = clamp(ent.x, ent.r, world.w-ent.r);
        ent.y = clamp(ent.y, ent.r, world.h-ent.r);
      }
    }
  }
  function updateCam(){
    const tx=player.x-innerWidth/2, ty=player.y-innerHeight/2;
    cam.x += (tx-cam.x)*0.08; cam.y += (ty-cam.y)*0.08;
    cam.x = clamp(cam.x,0,world.w-innerWidth);
    cam.y = clamp(cam.y,0,world.h-innerHeight);
  }

  function nearestInteract(){
    let best=null;
    const consider=(label,action,hint,cx,cy)=>{
      const d=Math.hypot(player.x-cx, player.y-cy);
      if(d<92 && (!best || d<best.d)) best={d,label,action,hint,cx,cy};
    };
    for(const d of world.doors) consider(d.label,d.action,d.hint, d.x+d.w/2, d.y+d.h/2);
    for(const s of world.solids) if(s.label && s.action) consider(s.label,s.action,null, s.x+s.w/2, s.y+s.h/2);
    for(const n of world.npcs) consider(n.label,n.action,n.hint,n.x,n.y);
    return best;
  }
  function tryInteract(){
    const n=nearestInteract();
    if(!n){ showToast("Nothing to interact with.", 800); return; }
    if(n.hint) showToast(`<b>${n.label}</b><br><span style="opacity:.8">${n.hint}</span>`, 800);
    else showToast(`<b>${n.label}</b>`, 550);
    setTimeout(()=>n.action(),120);
  }

  // ========= Backyard logic =========
  let tripT = 0;
  function eatMushroom(){
    tripT = Math.max(tripT, 3.5);
    showToast(`You taste the forest‚Äôs weird little joke‚Ä¶ üçÑ‚ú®`, 1200);
  }
  function gnomeKey(){
    if(save.hasFrontDoorKey){
      showToast(`The gnome nods. ‚ÄúAlready paid.‚Äù`, 1100);
      return;
    }
    save.hasFrontDoorKey = true;
    commitSave();
    showToast(`<b>KEY FOUND.</b><br>The gnome whispers: ‚ÄúFront door. Living room.‚Äù üîë`, 1500);
  }

  // ========= Rendering =========
  function outfitColor(name){
    switch(name){
      case "blue": return "#4aa6ff";
      case "red": return "#ff4a6b";
      case "green": return "#53ff86";
      case "black": return "#1a1a22";
      default: return "#8A2EFF";
    }
  }

  function drawGrass(){
    ctx.fillStyle="#060a0f";
    ctx.fillRect(0,0,world.w,world.h);

    // soft lawn
    ctx.fillStyle="rgba(90,180,120,.10)";
    for(let y=0;y<world.h;y+=46){
      ctx.fillRect(0,y,world.w,36);
    }

    // scattered fireflies
    for(let i=0;i<120;i++){
      const x=(i*97)%world.w, y=(i*173)%world.h;
      ctx.fillStyle=`rgba(255,255,255,${0.04 + ((i%7)/7)*0.05})`;
      ctx.fillRect(x, y, 1, 1);
    }

    // vignette
    const g=ctx.createRadialGradient(world.w/2,world.h/2,140, world.w/2,world.h/2, 980);
    g.addColorStop(0,"rgba(0,0,0,0)");
    g.addColorStop(1,"rgba(0,0,0,.62)");
    ctx.fillStyle=g;
    ctx.fillRect(0,0,world.w,world.h);
  }

  function drawObjectRect(x,y,w,h, tint){
    ctx.fillStyle="rgba(0,0,0,.35)";
    ctx.fillRect(x+10,y+10,w,h);
    ctx.fillStyle=tint;
    ctx.fillRect(x,y,w,h);
    ctx.strokeStyle="rgba(255,255,255,.14)";
    ctx.lineWidth=2;
    ctx.strokeRect(x,y,w,h);
  }

  function drawDoor(d){
    ctx.fillStyle="rgba(138,46,255,.10)";
    ctx.fillRect(d.x,d.y,d.w,d.h);
    ctx.strokeStyle="rgba(255,255,255,.18)";
    ctx.lineWidth=2;
    ctx.strokeRect(d.x,d.y,d.w,d.h);
    const g=ctx.createRadialGradient(d.x+d.w/2,d.y+d.h/2,10, d.x+d.w/2,d.y+d.h/2,120);
    g.addColorStop(0,"rgba(138,46,255,.22)"); g.addColorStop(1,"rgba(0,0,0,0)");
    ctx.fillStyle=g; ctx.fillRect(d.x-80,d.y-80,d.w+160,d.h+160);
  }

  function drawGnome(n){
    // tiny cursed-cute gnome
    ctx.fillStyle="rgba(0,0,0,.35)";
    ctx.beginPath(); ctx.ellipse(n.x, n.y+14, 16, 7, 0, 0, Math.PI*2); ctx.fill();

    ctx.fillStyle="rgba(255,255,255,.10)";
    ctx.beginPath(); ctx.arc(n.x, n.y, 18, 0, Math.PI*2); ctx.fill();

    ctx.fillStyle="rgba(255,90,130,.35)";
    ctx.beginPath(); ctx.arc(n.x, n.y-16, 16, 0, Math.PI*2); ctx.fill();

    ctx.fillStyle="rgba(255,255,255,.22)";
    ctx.font="11px ui-monospace, Menlo, monospace";
    ctx.fillText("GNOME", n.x-22, n.y-26);
  }

  function drawMushrooms(){
    // mushrooms sparkly patch
    const x=540, y=580, w=300, h=180;
    const glow=ctx.createRadialGradient(x+w/2,y+h/2,20, x+w/2,y+h/2, 240);
    glow.addColorStop(0,"rgba(138,46,255,.22)");
    glow.addColorStop(1,"rgba(0,0,0,0)");
    ctx.fillStyle=glow;
    ctx.fillRect(x-80,y-80,w+160,h+160);

    for(let i=0;i<38;i++){
      const mx=x+(i*37)%w, my=y+(i*71)%h;
      ctx.fillStyle="rgba(255,255,255,.10)";
      ctx.beginPath(); ctx.arc(mx,my,4,0,Math.PI*2); ctx.fill();
      ctx.fillStyle="rgba(255,90,180,.14)";
      ctx.beginPath(); ctx.arc(mx,my-6,6,0,Math.PI*2); ctx.fill();
    }
  }

  function drawCharacter(){
    const col=outfitColor(save.outfit);
    const bob=player.dancing?Math.sin(tt*10)*3:0;
    const jump=player.jumpT>0?Math.sin((1-player.jumpT)*Math.PI)*12:0;
    const splits=player.splitsT>0?(1-player.splitsT/0.6):0;

    const x=player.x, y=player.y - jump + bob;

    ctx.fillStyle="rgba(0,0,0,.35)";
    ctx.beginPath(); ctx.ellipse(x, player.y+10, 18, 9, 0, 0, Math.PI*2); ctx.fill();

    const aura=ctx.createRadialGradient(x,y-22,6, x,y-22, 40);
    aura.addColorStop(0,"rgba(180,140,255,.22)");
    aura.addColorStop(1,"rgba(0,0,0,0)");
    ctx.fillStyle=aura; ctx.beginPath(); ctx.arc(x,y-18,40,0,Math.PI*2); ctx.fill();

    ctx.fillStyle="rgba(255,245,235,.95)";
    ctx.beginPath(); ctx.arc(x,y-18,12,0,Math.PI*2); ctx.fill();

    ctx.fillStyle="rgba(20,20,30,.85)";
    ctx.beginPath(); ctx.arc(x,y-22,14,0,Math.PI*2); ctx.fill();

    ctx.fillStyle=col;
    ctx.beginPath();
    ctx.moveTo(x,y-6); ctx.lineTo(x-14,y+16); ctx.lineTo(x+14,y+16);
    ctx.closePath(); ctx.fill();

    ctx.strokeStyle="rgba(255,245,235,.85)";
    ctx.lineWidth=4; ctx.lineCap="round";
    ctx.beginPath();
    if(splits>0){
      ctx.moveTo(x,y+16); ctx.lineTo(x-18-10*splits,y+24);
      ctx.moveTo(x,y+16); ctx.lineTo(x+18+10*splits,y+24);
    }else{
      ctx.moveTo(x-4,y+16); ctx.lineTo(x-6,y+26);
      ctx.moveTo(x+4,y+16); ctx.lineTo(x+6,y+26);
    }
    ctx.stroke();
  }

  function drawMilo(){
    milo.purr += 0.02;
    const tail=Math.sin(milo.purr*4)*6;

    ctx.fillStyle="rgba(0,0,0,.28)";
    ctx.beginPath(); ctx.ellipse(milo.x,milo.y+8,14,7,0,0,Math.PI*2); ctx.fill();

    ctx.fillStyle="rgba(255,255,255,.90)";
    ctx.beginPath(); ctx.ellipse(milo.x,milo.y,12,9,0,0,Math.PI*2); ctx.fill();
    ctx.beginPath(); ctx.arc(milo.x+10,milo.y-6,7,0,Math.PI*2); ctx.fill();

    ctx.beginPath();
    ctx.moveTo(milo.x+6,milo.y-11); ctx.lineTo(milo.x+10,milo.y-18); ctx.lineTo(milo.x+14,milo.y-11);
    ctx.closePath(); ctx.fill();

    ctx.strokeStyle="rgba(255,255,255,.85)";
    ctx.lineWidth=4; ctx.lineCap="round";
    ctx.beginPath();
    ctx.moveTo(milo.x-10,milo.y+2);
    ctx.quadraticCurveTo(milo.x-24,milo.y-6, milo.x-16,milo.y-16+tail);
    ctx.stroke();

    ctx.fillStyle="rgba(30,30,40,.55)";
    ctx.fillRect(milo.x+12,milo.y-8,2,2);
  }

  function render(){
    ctx.clearRect(0,0,innerWidth,innerHeight);
    ctx.save();
    ctx.translate(-cam.x, -cam.y);

    drawGrass();

    // Objects
    for(const s of world.solids){
      let tint="rgba(255,255,255,.05)";
      if(s.label==="Hammock") tint="rgba(160,210,255,.07)";
      if(s.label==="Ping Pong") tint="rgba(255,255,255,.06)";
      if(s.label==="Mushroom Field") tint="rgba(138,46,255,.06)";
      drawObjectRect(s.x,s.y,s.w,s.h,tint);

      if(s.label){
        ctx.fillStyle="rgba(255,255,255,.22)";
        ctx.font="11px ui-monospace, Menlo, monospace";
        ctx.fillText(s.label, s.x+10, s.y+18);
      }
    }

    drawMushrooms();

    for(const d of world.doors) drawDoor(d);
    for(const n of world.npcs) drawGnome(n);

    drawMilo();
    drawCharacter();

    // Interact prompt
    const n=nearestInteract();
    if(n){
      ctx.strokeStyle="rgba(138,46,255,.45)";
      ctx.lineWidth=2;
      ctx.beginPath(); ctx.ellipse(player.x,player.y+8,28,14,0,0,Math.PI*2); ctx.stroke();

      const text=`E ¬∑ ${n.label}`;
      ctx.font="12px ui-monospace, Menlo, monospace";
      const m=ctx.measureText(text);
      const px=player.x - m.width/2 - 10;
      const py=player.y - 44;
      ctx.fillStyle="rgba(0,0,0,.45)";
      ctx.strokeStyle="rgba(255,255,255,.14)";
      ctx.lineWidth=1;
      ctx.beginPath(); roundRect(px,py,m.width+20,22,10); ctx.fill(); ctx.stroke();
      ctx.fillStyle="rgba(255,255,255,.88)";
      ctx.fillText(text, player.x - m.width/2, py+15);
    }

    // Trip overlay
    if(tripT>0){
      const wob = Math.sin(tt*10)*6;
      ctx.globalAlpha = 0.15 + 0.12*Math.sin(tt*6);
      ctx.fillStyle = "rgba(138,46,255,1)";
      ctx.fillRect(0+wob, 0, world.w, world.h);
      ctx.globalAlpha = 0.18;
      ctx.fillStyle = "rgba(0,255,210,1)";
      ctx.fillRect(0, 0+wob, world.w, world.h);
      ctx.globalAlpha = 1;
    }

    ctx.restore();
  }

  function roundRect(x,y,w,h,r){
    const rr=Math.min(r,w/2,h/2);
    ctx.moveTo(x+rr,y);
    ctx.arcTo(x+w,y,x+w,y+h,rr);
    ctx.arcTo(x+w,y+h,x,y+h,rr);
    ctx.arcTo(x,y+h,x,y,rr);
    ctx.arcTo(x,y,x+w,y,rr);
    ctx.closePath();
  }

  // ========= Loop =========
  let last=performance.now();
  let tt=0;
  function step(now){
    const dt=Math.min(0.033,(now-last)/1000);
    last=now; tt+=dt;

    const a=axis();
    let sp=(down("shift")?220:150);
    if(player.dancing) sp*=0.65;

    const mag=Math.hypot(a.x,a.y)||1;
    const ax=a.x/mag, ay=a.y/mag;

    player.vx += (ax*sp - player.vx)*0.18;
    player.vy += (ay*sp - player.vy)*0.18;
    player.x += player.vx*dt; player.y += player.vy*dt;

    if(Math.abs(ax)+Math.abs(ay)>0.01){ player.facing.x=ax; player.facing.y=ay; }

    resolveSolids(player);

    const followDist=46;
    const tx=player.x - player.facing.x*followDist - 18;
    const ty=player.y - player.facing.y*followDist + 14;
    milo.x += (tx-milo.x)*0.08;
    milo.y += (ty-milo.y)*0.08;
    resolveSolids(milo);

    player.jumpT=Math.max(0,player.jumpT-dt);
    player.splitsT=Math.max(0,player.splitsT-dt);
    tripT=Math.max(0,tripT-dt);

    updateCam();
    render();
    requestAnimationFrame(step);
  }

  commitSave();
  showToast(`The gnome knows something.`, 1400);
  requestAnimationFrame(step);
})();
</script>
</body>
</html>
