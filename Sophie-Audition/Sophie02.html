<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Sophia's Audition 02 — Backyard</title>
<style>
  :root{ --bg:#07070b; --fg:#fff; --ui2:rgba(255,255,255,.14); --vio:#8a2eff;}
  html,body{height:100%; margin:0; background:var(--bg); color:var(--fg); font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;}
  .wrap{height:100%; display:grid; place-items:center;}
  canvas{width:min(980px, 100vw); height:auto; image-rendering:pixelated; image-rendering:crisp-edges; touch-action:none;}
  .hud{
    position:fixed; left:12px; right:12px; top:12px; z-index:5;
    display:flex; gap:10px; flex-wrap:wrap; pointer-events:none;
  }
  .pill{
    pointer-events:auto; border:1px solid var(--ui2); background:rgba(0,0,0,.35);
    backdrop-filter: blur(8px);
    border-radius:999px; padding:10px 12px;
    font-size:11px; letter-spacing:.18em; text-transform:uppercase;
    display:flex; gap:10px; align-items:center;
  }
  .toast{
    position:fixed; left:50%; bottom:16px; transform:translateX(-50%);
    border:1px solid var(--ui2); background:rgba(0,0,0,.55);
    border-radius:14px; padding:10px 12px;
    font-size:12px; letter-spacing:.08em; opacity:0; transition:.2s;
    max-width:min(720px, calc(100vw - 24px)); text-align:center;
  }
  .toast.on{opacity:1}
</style>
</head>
<body>
<div class="hud">
  <div class="pill"><b>SOPHIA</b> <span id="status">BACKYARD</span></div>
  <div class="pill">TRIP: <span id="trip">OFF</span></div>
  <div class="pill">MILO: <span id="miloMood">following</span></div>
  <div class="pill">KEYS: <span id="keys">NO</span></div>
  <div class="pill">Door → Bedroom (bottom)</div>
</div>
<div class="toast" id="toast"></div>
<div class="wrap"><canvas id="c" width="320" height="180"></canvas></div>

<script>

/* ========= ORIGINAL ENGINE (UNCHANGED) ========= */

const canvas = document.getElementById('c');
const ctx = canvas.getContext('2d', { alpha:false });
ctx.imageSmoothingEnabled = false;

const UI = {
  trip: document.getElementById('trip'),
  keys: document.getElementById('keys'),
  miloMood: document.getElementById('miloMood'),
  toast: document.getElementById('toast'),
};
const STORE_KEY = "SOPHIA_AUDITION_SAVE_V1";
function loadState(){
  const raw = localStorage.getItem(STORE_KEY);
  if(raw){ try{return JSON.parse(raw);}catch(e){} }
  return {hasKeys:false, slept:false, trip:false, puke:false, poemLines:0, guitarPlayed:0, lastRoom:"BACKYARD", sophia:{x:160,y:120}, milo:{x:148,y:132}};
}
function saveState(){ localStorage.setItem(STORE_KEY, JSON.stringify(state)); }
let state = loadState();
state.lastRoom = "BACKYARD";
saveState();

UI.keys.textContent = state.hasKeys ? "YES" : "NO";
UI.trip.textContent = state.trip ? "ON" : "OFF";
UI.miloMood.textContent = state.trip ? "playing" : "following";

function toast(msg, ms=1400){
  UI.toast.textContent = msg;
  UI.toast.classList.add('on');
  clearTimeout(toast._t);
  toast._t = setTimeout(()=>UI.toast.classList.remove('on'), ms);
}

/* ========= ADDITIONS START HERE ========= */

/* --- Sneaky gnome entity --- */
const gnome = {x:60,y:120,dir:1,spd:0.6,alive:true};

function catchGnome(){
  if(!gnome.alive) return;
  if(Math.abs(sophia.x-gnome.x)<14 && Math.abs(sophia.y-gnome.y)<14){
    gnome.alive=false;
    state.hasKeys=true;
    UI.keys.textContent="YES";
    saveState();
    toast("You caught the gnome. He drops your keys. He vanishes in shame.",2000);
  }
}

/* --- grapes zone --- */
function eatGrapes(){
  toast("You eat the grapes. They're suspiciously powerful.",1500);
  state.trip=true;
  UI.trip.textContent="ON";
  saveState();
}

/* inject new zones */
zones.push(
 {name:"GRAPES", rect:[42,110,24,18], action:eatGrapes}
);

/* ========= END ADDITIONS ========= */

/* ========= EXISTING GAME LOOP MOD (SAFE APPEND) ========= */

let _oldLoop = loop;
loop = function(){
  _oldLoop();

  /* gnome movement */
  if(gnome.alive){
    gnome.x += gnome.dir*gnome.spd;
    if(gnome.x<20 || gnome.x>W-20) gnome.dir*=-1;
    if(Math.random()<0.01) gnome.dir*=-1;
  }

  catchGnome();

  /* draw gnome */
  if(gnome.alive){
    ctx.fillStyle="#7aff7a";
    ctx.fillRect(Math.round(gnome.x),Math.round(gnome.y),5,6);
    ctx.fillStyle="#ff2e2e";
    ctx.fillRect(Math.round(gnome.x+1),Math.round(gnome.y-2),3,2);
  }

  /* draw grapes */
  ctx.fillStyle="#a84cff";
  ctx.fillRect(42,110,6,6);
  ctx.fillRect(48,112,6,6);
  ctx.fillRect(46,116,6,6);
};

</script>
</body>
</html>
