<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Sophia's Audition — Hammock</title>
<style>
  :root{ --bg:#07070b; --fg:#fff; --ui2:rgba(255,255,255,.14); --vio:#8a2eff; --aqua:#00ffd5; --hot:#ff63ff; --sun:#ffd24d;}
  html,body{height:100%; margin:0; background:var(--bg); color:var(--fg); font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;}
  .wrap{height:100%; display:grid; place-items:center;}
  canvas{width:min(980px, 100vw); height:auto; image-rendering:pixelated; image-rendering:crisp-edges; touch-action:none;}
  body::before{
    content:""; position:fixed; inset:-20%; pointer-events:none;
    background:
      radial-gradient(circle at 18% 12%, rgba(138,46,255,.20), transparent 62%),
      radial-gradient(circle at 78% 20%, rgba(0,255,213,.12), transparent 62%),
      radial-gradient(circle at 50% 92%, rgba(255,99,255,.10), transparent 72%);
    filter:blur(44px) saturate(1.25);
    animation:drift 12s ease-in-out infinite;
  }
  body::after{
    content:""; position:fixed; inset:0; pointer-events:none;
    background:
      radial-gradient(1200px 900px at 50% 45%, rgba(0,0,0,0) 0%, rgba(0,0,0,.35) 70%, rgba(0,0,0,.62) 100%),
      repeating-linear-gradient(0deg, rgba(255,255,255,.018) 0 1px, transparent 1px 4px);
    mix-blend-mode:overlay; opacity:.55;
  }
  @keyframes drift{0%,100%{transform:translate3d(0,0,0)}50%{transform:translate3d(1.6%,-1.2%,0)}}

  .hud{
    position:fixed; left:12px; right:12px; top:12px; z-index:5;
    display:flex; gap:10px; flex-wrap:wrap; pointer-events:none;
  }
  .pill{
    pointer-events:auto; border:1px solid var(--ui2); background:rgba(0,0,0,.35);
    backdrop-filter: blur(8px);
    border-radius:999px; padding:10px 12px;
    font-size:11px; letter-spacing:.18em; text-transform:uppercase;
    display:flex; gap:10px; align-items:center;
  }
  .toast{
    position:fixed; left:50%; bottom:16px; transform:translateX(-50%);
    border:1px solid var(--ui2); background:rgba(0,0,0,.55);
    border-radius:14px; padding:10px 12px;
    font-size:12px; letter-spacing:.08em; opacity:0; transition:.2s;
    max-width:min(820px, calc(100vw - 24px)); text-align:center;
    z-index:6;
  }
  .toast.on{opacity:1}
</style>
</head>
<body>
<div class="hud">
  <div class="pill"><b>SOPHIA</b> <span id="status">HAMMOCK</span></div>
  <div class="pill">SWING: <span id="swing">0%</span></div>
  <div class="pill">COSMOS: <span id="cosmos">CALM</span></div>
  <div class="pill">MILO: <span id="miloMood">orbiting</span></div>
  <div class="pill">TRIP: <span id="trip">OFF</span></div>
  <div class="pill">E → BACKYARD</div>
</div>
<div class="toast" id="toast"></div>
<div class="wrap"><canvas id="c" width="320" height="180"></canvas></div>

<script>
const canvas = document.getElementById('c');
const ctx = canvas.getContext('2d', { alpha:false });
ctx.imageSmoothingEnabled = false;

const UI = {
  swing: document.getElementById('swing'),
  cosmos: document.getElementById('cosmos'),
  miloMood: document.getElementById('miloMood'),
  trip: document.getElementById('trip'),
  toast: document.getElementById('toast'),
};

const STORE_KEY = "SOPHIA_AUDITION_SAVE_V1";
function loadState(){
  const raw = localStorage.getItem(STORE_KEY);
  if(raw){ try{return JSON.parse(raw);}catch(e){} }
  return { trip:false, dressColor:"#a64dff", shoeColor:"#ffffff", inv:{shrooms:0, grapes:0}, sophia:{x:160,y:120}, milo:{x:148,y:132} };
}
function saveState(){ localStorage.setItem(STORE_KEY, JSON.stringify(state)); }
let state = loadState();
state.inv = state.inv || {shrooms:0, grapes:0};

function toast(msg, ms=1500){
  UI.toast.textContent = msg;
  UI.toast.classList.add('on');
  clearTimeout(toast._t);
  toast._t = setTimeout(()=>UI.toast.classList.remove('on'), ms);
}

const keysDown = new Set();
addEventListener('keydown',(e)=>{
  const k = e.key.toLowerCase();
  if(["arrowup","arrowdown","arrowleft","arrowright"," ","shift","w","a","s","d","e","c","t","enter"].includes(k)) e.preventDefault();
  keysDown.add(k);
});
addEventListener('keyup',(e)=>keysDown.delete(e.key.toLowerCase()));

// Touch: swipe left/right to swing, tap to "wish"
let touch = {active:false, x:0, dx:0, tapTime:0};
canvas.addEventListener('pointerdown',(e)=>{
  canvas.setPointerCapture(e.pointerId);
  touch.active=true; touch.x=e.clientX; touch.dx=0; touch.tapTime=performance.now();
});
canvas.addEventListener('pointermove',(e)=>{
  if(!touch.active) return;
  touch.dx = (e.clientX - touch.x);
});
canvas.addEventListener('pointerup',(e)=>{
  if(!touch.active) return;
  const dt = performance.now() - touch.tapTime;
  const moved = Math.abs(touch.dx);
  touch.active=false;

  if(dt < 220 && moved < 10){
    // tap: wish
    spawnWishSpark();
    if(!state.trip && Math.random()<0.25){
      state.trip = true; saveState();
      toast("You wished too hard. Trip toggled ON.", 1700);
    }else{
      toast("A tiny wish evaporates into starlight.", 1500);
    }
  }
  touch.dx = 0;
});

const W=canvas.width, H=canvas.height;

// Scene: a hammock floating in space, Sophia chilling, Milo orbiting
let t=0;
let swing=0;      // -1..1
let swingV=0;
let calm=1;       // 0..1
let nebPulse=0;

// Stars and “universe” objects
const stars = [];
function seedStars(){
  stars.length=0;
  for(let i=0;i<160;i++){
    stars.push({
      x: Math.random()*W,
      y: Math.random()*H,
      z: Math.random()*1,
      tw: Math.random()*Math.PI*2,
      sp: 0.15 + Math.random()*0.55
    });
  }
}
seedStars();

let sparks=[];
function spawnWishSpark(){
  const cx = W*0.5 + swing*10;
  const cy = H*0.50;
  for(let i=0;i<18;i++){
    const a = Math.random()*Math.PI*2;
    const r = 0.5 + Math.random()*2.0;
    sparks.push({
      x:cx, y:cy,
      vx:Math.cos(a)*r, vy:Math.sin(a)*r - 0.4,
      life:30 + Math.random()*25
    });
  }
}
function updateSparks(){
  for(const p of sparks){
    p.x += p.vx; p.y += p.vy;
    p.vx *= 0.98; p.vy = p.vy*0.98 + 0.02;
    p.life -= 1;
  }
  sparks = sparks.filter(p=>p.life>0);
}
function drawSparks(){
  for(const p of sparks){
    const a = Math.max(0, Math.min(0.22, p.life/120));
    ctx.fillStyle = `rgba(255,255,255,${a})`;
    ctx.fillRect(p.x|0, p.y|0, 1, 1);
  }
}

function syncHUD(){
  UI.swing.textContent = `${Math.round(Math.abs(swing)*100)}%`;
  UI.trip.textContent = state.trip ? "ON" : "OFF";
  UI.miloMood.textContent = state.trip ? "zooming" : "orbiting";
  UI.cosmos.textContent = calm > 0.7 ? "CALM" : (calm > 0.35 ? "WAVY" : "WILD");
}
syncHUD();

function goBack(){
  saveState();
  location.href="Sophie02.html";
}

// Drawing helpers: same sprite vibe as Backyard
function drawSophiaRelaxed(x,y){
  // lounging pose in hammock: rotated vibe via pixels
  const dress = state.dressColor || "#a64dff";
  const shoes = state.shoeColor || "#ffffff";

  // hair/head
  ctx.fillStyle="#f2d27a"; ctx.fillRect(x+3,y+2,8,3); ctx.fillRect(x+2,y+4,10,3);
  // face
  ctx.fillStyle="#ffd9c9"; ctx.fillRect(x+4,y+6,6,4);
  // sleepy eyes
  ctx.fillStyle="rgba(103,183,255,.55)"; ctx.fillRect(x+5,y+7,1,1); ctx.fillRect(x+8,y+7,1,1);

  // torso/dress, lying sideways
  ctx.fillStyle=dress; ctx.fillRect(x+6,y+10,7,3); ctx.fillRect(x+9,y+9,4,2);

  // legs
  ctx.fillStyle="rgba(255,255,255,.06)"; ctx.fillRect(x+12,y+11,5,2);
  // shoes
  ctx.fillStyle=shoes; ctx.fillRect(x+16,y+11,2,1);
}

function drawMilo(x,y,phase){
  // floating cat orb
  ctx.fillStyle="rgba(0,0,0,.40)"; ctx.fillRect(x-1,y+7,10,2);
  ctx.fillStyle="#d8d8d8"; ctx.fillRect(x+1,y+2,6,5);
  ctx.fillStyle="#cfcfcf"; ctx.fillRect(x+1,y+1,2,2); ctx.fillRect(x+5,y+1,2,2);

  const eye = state.trip ? "rgba(255,99,255,.9)" : "rgba(26,255,211,.9)";
  ctx.fillStyle=eye; ctx.fillRect(x+2,y+4,1,1); ctx.fillRect(x+5,y+4,1,1);

  // tail flick
  ctx.fillStyle="#cfcfcf";
  const wig = state.trip ? ((Math.sin(phase)*1.2)|0) : ((Math.sin(phase*0.6)*0.6)|0);
  ctx.fillRect(x+7, y+3+wig, 1, 3);
}

function drawHammock(cx,cy,amp){
  // anchor posts
  ctx.fillStyle="rgba(255,255,255,.10)";
  ctx.fillRect((cx-72)|0, (cy-28)|0, 3, 58);
  ctx.fillRect((cx+69)|0, (cy-28)|0, 3, 58);

  // ropes
  ctx.fillStyle="rgba(255,255,255,.08)";
  ctx.fillRect((cx-69)|0, (cy-22)|0, 18, 1);
  ctx.fillRect((cx+51)|0, (cy-22)|0, 18, 1);

  // hammock bed (curved)
  const w=120;
  for(let i=0;i<w;i++){
    const u = i/(w-1);
    const curve = Math.sin(u*Math.PI) * (10 + amp*8);
    const y = (cy + 8 + curve)|0;
    const x = (cx - 60 + i)|0;
    ctx.fillStyle = state.trip ? "rgba(255,99,255,.14)" : "rgba(138,46,255,.10)";
    ctx.fillRect(x,y,1,2);
    if(i%10===0){
      ctx.fillStyle="rgba(255,255,255,.06)";
      ctx.fillRect(x,y-1,1,1);
    }
  }

  // tiny glow under hammock
  ctx.fillStyle="rgba(0,0,0,.35)";
  ctx.fillRect((cx-60)|0, (cy+22)|0, 120, 5);
}

function drawStarfield(){
  ctx.fillStyle="#05050a";
  ctx.fillRect(0,0,W,H);

  // Nebula wash
  const pulse = 0.10 + 0.06*Math.sin(nebPulse);
  ctx.fillStyle = `rgba(138,46,255,${pulse})`;
  ctx.fillRect(0,0,W,H);

  // Stars parallax + twinkle
  for(const s of stars){
    const tw = 0.12 + 0.10*Math.sin(s.tw + t*0.06*s.sp);
    const a = state.trip ? (tw + 0.05*Math.sin(t*0.12 + s.x)) : tw;

    // slight drift based on swing and calm
    let x = s.x + swing*8*(0.2+s.z);
    let y = s.y + (1-calm)*4*(0.2+s.z)*Math.sin(t*0.02 + s.x);

    // wrap
    x = (x+W)%W;
    y = (y+H)%H;

    ctx.fillStyle = `rgba(255,255,255,${Math.max(0,Math.min(0.22,a))})`;
    ctx.fillRect(x|0, y|0, 1, 1);

    if(state.trip && Math.random()<0.015){
      ctx.fillStyle="rgba(0,255,213,.10)";
      ctx.fillRect((x+1)|0, (y)|0, 1, 1);
    }
  }

  // Subtle vignette
  ctx.fillStyle="rgba(0,0,0,.18)";
  ctx.fillRect(0,0,W,12); ctx.fillRect(0,H-12,W,12); ctx.fillRect(0,0,12,H); ctx.fillRect(W-12,0,12,H);
}

function loop(){
  t++;

  // Controls
  // A/D swing
  let push=0;
  if(keysDown.has("a") || keysDown.has("arrowleft")) push -= 1;
  if(keysDown.has("d") || keysDown.has("arrowright")) push += 1;
  if(touch.active) push += Math.max(-1, Math.min(1, touch.dx / 120));

  // space: little “kick”
  if((keysDown.has(" ")||keysDown.has("space")) && !loop._sp){
    swingV += (swing>=0 ? 0.18 : -0.18);
    spawnWishSpark();
    toast("Kick the hammock. The cosmos nods.", 1200);
    loop._sp=1;
  }
  if(!(keysDown.has(" ")||keysDown.has("space"))) loop._sp=0;

  // T: toggle trip
  if(keysDown.has("t") && !loop._t){
    state.trip = !state.trip;
    saveState();
    toast(state.trip ? "Trip ON. Stars start gossiping." : "Trip OFF. Quiet returns.", 1600);
    loop._t=1;
  }
  if(!keysDown.has("t")) loop._t=0;

  // E: exit
  if(keysDown.has("e") && !loop._e){
    goBack();
    loop._e=1;
  }
  if(!keysDown.has("e")) loop._e=0;

  // Physics
  swingV += push * 0.014;
  swingV *= 0.985;
  swing += swingV;

  // clamp but with soft edges
  if(swing > 1){ swing=1; swingV*=-0.6; }
  if(swing < -1){ swing=-1; swingV*=-0.6; }

  // Calm meter: faster swing = less calm
  calm += (1 - Math.min(1, Math.abs(swingV)*8) - calm) * 0.05;
  calm = Math.max(0.05, Math.min(1, calm));

  // Nebula pulse
  nebPulse += state.trip ? 0.06 : 0.03;

  updateSparks();
  syncHUD();

  // Draw
  drawStarfield();

  const cx = (W*0.5 + swing*14)|0;
  const cy = (H*0.52 + Math.sin(t*0.03)*1)|0;

  // Cosmic “planets” drifting by
  if(state.trip){
    const px = (W*0.18 + Math.sin(t*0.01)*18)|0;
    const py = (H*0.22 + Math.cos(t*0.012)*10)|0;
    ctx.fillStyle="rgba(0,255,213,.08)";
    ctx.fillRect(px-10, py-6, 20, 12);
  }
  const qx = (W*0.82 + Math.sin(t*0.008+2)*12)|0;
  const qy = (H*0.75 + Math.cos(t*0.009+1)*10)|0;
  ctx.fillStyle="rgba(255,210,77,.06)";
  ctx.fillRect(qx-14, qy-10, 28, 20);

  drawHammock(cx,cy, Math.abs(swing));

  // Sophia lounging on the hammock bed
  const sx = (cx - 10 + swing*6)|0;
  const sy = (cy + 2 + Math.sin(t*0.06)*1)|0;
  drawSophiaRelaxed(sx, sy);

  // Milo orbiting in the cosmos
  const orbR = state.trip ? 26 : 18;
  const ang = t*(state.trip ? 0.08 : 0.05) + swing*0.5;
  const mx = (cx + Math.cos(ang)*orbR)|0;
  const my = (cy - 26 + Math.sin(ang*1.2)*10)|0;
  drawMilo(mx, my, ang);

  drawSparks();

  // Subtle trip scanlines
  if(state.trip){
    ctx.fillStyle = `rgba(255,99,255,${0.08 + 0.05*Math.sin(t*0.07)})`;
    ctx.fillRect(0,0,W,H);
    for(let y=0;y<H;y+=3){
      ctx.fillStyle = `rgba(0,255,213,${0.02 + 0.02*Math.sin(t*0.12 + y*0.2)})`;
      ctx.fillRect(0,y,W,1);
    }
  }

  requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>
