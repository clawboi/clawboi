<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Sophia's Audition — TV</title>
<style>
  :root{ --bg:#07070b; --fg:#fff; --ui2:rgba(255,255,255,.14); --vio:#8a2eff;}
  html,body{height:100%; margin:0; background:var(--bg); color:var(--fg); font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;}

  body::before{
    content:""; position:fixed; inset:-20%;
    background:
      radial-gradient(circle at 20% 10%, rgba(138,46,255,.16), transparent 60%),
      radial-gradient(circle at 80% 40%, rgba(0,255,213,.10), transparent 65%),
      radial-gradient(circle at 50% 92%, rgba(138,46,255,.10), transparent 70%);
    filter:blur(40px) saturate(1.15);
    animation:drift 12s ease-in-out infinite;
    pointer-events:none;
  }
  body::after{
    content:""; position:fixed; inset:0; pointer-events:none;
    background:
      radial-gradient(1200px 900px at 50% 45%, rgba(0,0,0,0) 0%, rgba(0,0,0,.35) 70%, rgba(0,0,0,.60) 100%),
      repeating-linear-gradient(0deg, rgba(255,255,255,.018) 0 1px, transparent 1px 4px);
    mix-blend-mode:overlay; opacity:.55;
  }
  @keyframes drift{0%,100%{transform:translate3d(0,0,0)}50%{transform:translate3d(1.5%,-1.5%,0)}}

  .wrap{height:100%; display:grid; place-items:center;}
  canvas{width:min(980px, 100vw); height:auto; image-rendering:pixelated; image-rendering:crisp-edges; touch-action:none;}

  .hud{
    position:fixed; left:12px; right:12px; top:12px; z-index:5;
    display:flex; gap:10px; flex-wrap:wrap; pointer-events:none;
  }
  .pill{
    pointer-events:auto; border:1px solid var(--ui2); background:rgba(0,0,0,.35);
    backdrop-filter: blur(8px);
    border-radius:999px; padding:10px 12px;
    font-size:11px; letter-spacing:.18em; text-transform:uppercase;
    display:flex; gap:10px; align-items:center;
  }
  .toast{
    position:fixed; left:50%; bottom:16px; transform:translateX(-50%);
    border:1px solid var(--ui2); background:rgba(0,0,0,.55);
    border-radius:14px; padding:10px 12px;
    font-size:12px; letter-spacing:.08em; opacity:0; transition:.2s;
    max-width:min(720px, calc(100vw - 24px)); text-align:center;
    z-index:6;
  }
  .toast.on{opacity:1}
</style>
</head>
<body>
<div class="hud">
  <div class="pill"><b>SOPHIA</b> <span>TV</span></div>
  <div class="pill">CHANNEL: <span id="ch">01</span></div>
  <div class="pill">VIBE: <span id="vibe">CALM</span></div>
  <div class="pill">←/→ change · SPACE “react” · T toggle trip</div>
  <div class="pill">E → LIVING ROOM</div>
</div>
<div class="toast" id="toast"></div>
<div class="wrap"><canvas id="c" width="320" height="180"></canvas></div>

<script>
const canvas=document.getElementById('c');
const ctx=canvas.getContext('2d',{alpha:false});
ctx.imageSmoothingEnabled=false;

const UI={ ch:document.getElementById('ch'), vibe:document.getElementById('vibe'), toast:document.getElementById('toast') };

const STORE_KEY="SOPHIA_AUDITION_SAVE_V1";
function loadState(){
  const r=localStorage.getItem(STORE_KEY);
  if(r){ try{return JSON.parse(r);}catch(e){} }
  return { trip:false, dressColor:"#a64dff", shoeColor:"#ffffff", sophia:{x:160,y:120}, milo:{x:148,y:132} };
}
function saveState(){ localStorage.setItem(STORE_KEY, JSON.stringify(state)); }
let state=loadState();

function toast(msg,ms=1500){
  UI.toast.textContent=msg;
  UI.toast.classList.add('on');
  clearTimeout(toast._t);
  toast._t=setTimeout(()=>UI.toast.classList.remove('on'),ms);
}

const keysDown=new Set();
addEventListener('keydown',(e)=>{
  const k=e.key.toLowerCase();
  if(["arrowup","arrowdown","arrowleft","arrowright"," ","shift","w","a","s","d","e","t"].includes(k)) e.preventDefault();
  keysDown.add(k);
});
addEventListener('keyup',(e)=>keysDown.delete(e.key.toLowerCase()));

const W=canvas.width,H=canvas.height;

// Same pixel sprite vibe
function drawSophia(x,y){
  ctx.fillStyle="rgba(0,0,0,.45)"; ctx.fillRect(x-1,y+11,12,2);
  ctx.fillStyle="#f2d27a"; ctx.fillRect(x+1,y+0,8,4); ctx.fillRect(x+0,y+3,10,3);
  ctx.fillStyle="#ffd9c9"; ctx.fillRect(x+2,y+5,6,4);
  ctx.fillStyle="#67b7ff"; ctx.fillRect(x+3,y+6,1,1); ctx.fillRect(x+6,y+6,1,1);
  ctx.fillStyle="rgba(138,46,255,.55)"; ctx.fillRect(x+2,y+9,6,3);
  ctx.fillStyle="rgba(255,255,255,.14)"; ctx.fillRect(x+3,y+10,4,1);
}
function drawMilo(x,y,t){
  ctx.fillStyle="rgba(0,0,0,.40)"; ctx.fillRect(x-1,y+7,10,2);
  ctx.fillStyle="#d8d8d8"; ctx.fillRect(x+1,y+2,6,5);
  ctx.fillStyle="#cfcfcf"; ctx.fillRect(x+1,y+1,2,2); ctx.fillRect(x+5,y+1,2,2);
  const eye = state.trip ? "rgba(255,99,255,.95)" : "rgba(26,255,211,.95)";
  ctx.fillStyle=eye; ctx.fillRect(x+2,y+4,1,1); ctx.fillRect(x+5,y+4,1,1);
  ctx.fillStyle="#cfcfcf"; ctx.fillRect(x+7,y+3+((Math.sin(t*0.2)*1)|0),1,3);
}

function vignette(){
  ctx.fillStyle="rgba(0,0,0,.18)";
  ctx.fillRect(0,0,W,12); ctx.fillRect(0,H-12,W,12);
  ctx.fillRect(0,0,12,H); ctx.fillRect(W-12,0,12,H);
}

let channel=1;
let vibe=0; // -1..1
let sparks=[];
function popSpark(cx,cy){
  for(let i=0;i<12;i++){
    const a=Math.random()*Math.PI*2, r=0.6+Math.random()*2.2;
    sparks.push({x:cx,y:cy,vx:Math.cos(a)*r,vy:Math.sin(a)*r-0.3,life:26+Math.random()*18});
  }
}
function updateSparks(){
  for(const p of sparks){
    p.x+=p.vx; p.y+=p.vy; p.vx*=0.98; p.vy=p.vy*0.98+0.02; p.life-=1;
  }
  sparks=sparks.filter(p=>p.life>0);
}
function drawSparks(){
  for(const p of sparks){
    const a=Math.max(0,Math.min(.22,p.life/90));
    ctx.fillStyle=`rgba(255,255,255,${a})`;
    ctx.fillRect(p.x|0,p.y|0,1,1);
  }
}

function syncHUD(){
  UI.ch.textContent=String(channel).padStart(2,"0");
  const label = vibe>0.35 ? "HYPED" : (vibe<-0.35 ? "SLEEPY" : "CALM");
  UI.vibe.textContent = state.trip ? (label+" / TRIP") : label;
}
syncHUD();

function goBack(){ saveState(); location.href="Sophie03.html"; }

function drawTVScreen(t){
  // TV casing
  ctx.fillStyle="rgba(255,255,255,.06)";
  ctx.fillRect(72,22,176,90);
  ctx.fillStyle="rgba(0,0,0,.55)";
  ctx.fillRect(78,28,164,78);

  // channel visuals
  const x=78,y=28,w=164,h=78;
  if(channel===1){
    // news-ish scan
    for(let i=0;i<10;i++){
      ctx.fillStyle=`rgba(255,255,255,${0.02+(i%2)*0.02})`;
      ctx.fillRect(x, y+i*7, w, 1);
    }
    ctx.fillStyle="rgba(138,46,255,.12)";
    ctx.fillRect(x+10,y+12, w-20, 12);
    ctx.fillStyle="rgba(255,255,255,.10)";
    ctx.fillRect(x+10,y+30, w-40, 6);
    ctx.fillRect(x+10,y+40, w-60, 6);
    ctx.fillRect(x+10,y+50, w-50, 6);
  } else if(channel===2){
    // cozy cartoon blobs
    ctx.fillStyle="rgba(0,255,213,.10)";
    ctx.fillRect(x+18,y+18,40,30);
    ctx.fillStyle="rgba(255,99,255,.10)";
    ctx.fillRect(x+62,y+26,50,24);
    ctx.fillStyle="rgba(255,210,77,.08)";
    ctx.fillRect(x+120,y+16,28,40);
  } else if(channel===3){
    // cosmic field
    for(let i=0;i<60;i++){
      const sx=x+(Math.random()*w|0), sy=y+(Math.random()*h|0);
      ctx.fillStyle=`rgba(255,255,255,${0.03+Math.random()*0.08})`;
      ctx.fillRect(sx,sy,1,1);
    }
    ctx.fillStyle="rgba(138,46,255,.10)";
    ctx.fillRect(x+20,y+22,70,30);
  } else if(channel===4){
    // fitness channel
    ctx.fillStyle="rgba(0,255,213,.08)";
    ctx.fillRect(x+18,y+16,128,46);
    ctx.fillStyle="rgba(0,0,0,.35)";
    ctx.fillRect(x+22,y+20,120,38);
    if(t%20<10){
      ctx.fillStyle="rgba(255,255,255,.10)";
      ctx.fillRect(x+40,y+28,20,20);
      ctx.fillRect(x+92,y+28,20,20);
    } else {
      ctx.fillStyle="rgba(255,255,255,.10)";
      ctx.fillRect(x+58,y+26,20,24);
      ctx.fillRect(x+74,y+26,20,24);
    }
  } else {
    // static
    for(let i=0;i<250;i++){
      ctx.fillStyle=`rgba(255,255,255,${Math.random()*0.06})`;
      ctx.fillRect(x+(Math.random()*w|0), y+(Math.random()*h|0), 1, 1);
    }
  }

  // flicker glow
  const glow = state.trip ? "rgba(255,99,255,.12)" : "rgba(138,46,255,.10)";
  ctx.fillStyle=glow;
  ctx.fillRect(x,y,w,1); ctx.fillRect(x,y+h-1,w,1);

  // TV stand
  ctx.fillStyle="rgba(255,255,255,.05)";
  ctx.fillRect(92,114,136,10);
  ctx.fillStyle="rgba(0,0,0,.45)";
  ctx.fillRect(98,116,124,6);
}

let t=0;
function loop(){
  t++;

  if(keysDown.has("e") && !loop._e){ goBack(); loop._e=1; }
  if(!keysDown.has("e")) loop._e=0;

  if((keysDown.has("arrowleft")||keysDown.has("a")) && !loop._l){
    channel = channel<=1 ? 5 : channel-1;
    toast("Channel down.", 900);
    loop._l=1;
  }
  if(!(keysDown.has("arrowleft")||keysDown.has("a"))) loop._l=0;

  if((keysDown.has("arrowright")||keysDown.has("d")) && !loop._r){
    channel = channel>=5 ? 1 : channel+1;
    toast("Channel up.", 900);
    loop._r=1;
  }
  if(!(keysDown.has("arrowright")||keysDown.has("d"))) loop._r=0;

  if(keysDown.has("t") && !loop._t){
    state.trip=!state.trip; saveState();
    toast(state.trip?"Trip ON. The TV starts whispering.":"Trip OFF. Quiet picture.", 1300);
    loop._t=1;
  }
  if(!keysDown.has("t")) loop._t=0;

  if((keysDown.has(" ")||keysDown.has("space")) && !loop._sp){
    vibe += (channel===4?0.20:(channel===1?-0.12:0.10));
    vibe = Math.max(-1, Math.min(1, vibe));
    popSpark(160, 66);
    toast(channel===1 ? "Sophia: This is stressing me out." : "Milo purrs at the pixels.", 1200);
    loop._sp=1;
  }
  if(!(keysDown.has(" ")||keysDown.has("space"))) loop._sp=0;

  vibe *= 0.992;

  // draw room base
  ctx.fillStyle="#05050a"; ctx.fillRect(0,0,W,H);

  const g=ctx.createRadialGradient(160,64,10,160,64,190);
  g.addColorStop(0,"rgba(255,255,255,.06)");
  g.addColorStop(0.35, state.trip ? "rgba(255,99,255,.10)" : "rgba(138,46,255,.10)");
  g.addColorStop(1,"rgba(0,0,0,0)");
  ctx.fillStyle=g; ctx.fillRect(0,0,W,H);

  // floor
  ctx.fillStyle="rgba(255,255,255,.05)";
  ctx.fillRect(10,112,300,58);

  // couch chunk (for context)
  ctx.fillStyle="rgba(255,255,255,.06)";
  ctx.fillRect(36,92,104,22);
  ctx.fillStyle="rgba(0,0,0,.35)";
  ctx.fillRect(40,96,96,10);

  // TV screen
  drawTVScreen(t);

  // Sophia + Milo sit close
  drawSophia(52,104);
  drawMilo(70,110,t);

  updateSparks();
  drawSparks();

  // vibe overlay
  if(Math.abs(vibe)>0.05){
    const a=0.04+Math.abs(vibe)*0.06;
    ctx.fillStyle = vibe>0 ? `rgba(0,255,213,${a})` : `rgba(0,0,0,${a})`;
    ctx.fillRect(0,0,W,H);
  }

  // trip scanlines
  if(state.trip){
    ctx.fillStyle=`rgba(255,99,255,${0.08 + 0.05*Math.sin(t*0.07)})`;
    ctx.fillRect(0,0,W,H);
    for(let y=0;y<H;y+=3){
      ctx.fillStyle=`rgba(0,255,213,${0.02 + 0.02*Math.sin(t*0.12 + y*0.2)})`;
      ctx.fillRect(0,y,W,1);
    }
  }

  vignette();
  syncHUD();
  requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>
