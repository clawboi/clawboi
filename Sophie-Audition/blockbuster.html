<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Blockbuster</title>
<style>
  :root{ --bg:#07070b; --fg:#fff; --ui2:rgba(255,255,255,.14); --bbBlue:#1746ff; --bbYellow:#ffd200;}
  html,body{height:100%; margin:0; background:var(--bg); color:var(--fg); font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;}
  .wrap{height:100%; display:grid; place-items:center;}
  canvas{width:min(980px, 100vw); height:auto; image-rendering:pixelated; image-rendering:crisp-edges; touch-action:none;}
  .hud{position:fixed; left:12px; right:12px; top:12px; z-index:7; display:flex; gap:10px; flex-wrap:wrap; pointer-events:none;}
  .pill{pointer-events:auto; border:1px solid var(--ui2); background:rgba(0,0,0,.35); backdrop-filter: blur(8px);
    border-radius:999px; padding:10px 12px; font-size:11px; letter-spacing:.18em; text-transform:uppercase; display:flex; gap:10px; align-items:center; white-space:nowrap;}
  .toast{position:fixed; left:50%; bottom:16px; transform:translateX(-50%); border:1px solid var(--ui2); background:rgba(0,0,0,.55);
    border-radius:14px; padding:10px 12px; font-size:12px; letter-spacing:.08em; opacity:0; transition:.2s; max-width:min(860px, calc(100vw - 24px)); text-align:center; z-index:8;}
  .toast.on{opacity:1}
  .microhint{position:fixed; right:12px; bottom:12px; z-index:6; border:1px solid rgba(255,255,255,.10); background:rgba(0,0,0,.35);
    backdrop-filter: blur(8px); border-radius:14px; padding:8px 10px; font-size:10px; letter-spacing:.12em; opacity:.88; pointer-events:none;}
</style>
</head>
<body>
<div class="hud">
  <div class="pill"><b>BLOCKBUSTER</b> <span>BLUE/YELLOW</span></div>
  <div class="pill">SELECTED: <span id="count">0</span></div>
  <div class="pill">E: PICK · R: REMOVE LAST · ESC: EXIT</div>
</div>
<div class="toast" id="toast"></div>
<div class="microhint">Walk aisles. Hover a cover, press E to add to your list.</div>
<div class="wrap"><canvas id="c" width="320" height="180"></canvas></div>

<script>
const canvas=document.getElementById('c');
const ctx=canvas.getContext('2d',{alpha:false});
ctx.imageSmoothingEnabled=false;

const UI={toast:document.getElementById('toast'), count:document.getElementById('count')};

const STORE_KEY="SOPHIA_AUDITION_SAVE_V1";
function loadState(){
  const r=localStorage.getItem(STORE_KEY);
  if(r){ try{return JSON.parse(r);}catch(e){} }
  return { inventory:{movies:[]} };
}
function saveState(){ localStorage.setItem(STORE_KEY, JSON.stringify(state)); }

let state=loadState();
state.inventory=state.inventory||{movies:[]};
state.inventory.movies=state.inventory.movies||[];
saveState();

function toast(msg,ms=1400){
  UI.toast.textContent=msg;
  UI.toast.classList.add('on');
  clearTimeout(toast._t);
  toast._t=setTimeout(()=>UI.toast.classList.remove('on'),ms);
}
function clamp(v,a,b){ return Math.max(a, Math.min(b,v)); }
function sync(){ UI.count.textContent=String(state.inventory.movies.length); }
sync();

/* input */
const keysDown=new Set();
addEventListener('keydown',(e)=>{
  const k=e.key.toLowerCase();
  if(["arrowup","arrowdown","arrowleft","arrowright"," ","shift","w","a","s","d","e","r","escape"].includes(k)) e.preventDefault();
  keysDown.add(k);
});
addEventListener('keyup',(e)=>keysDown.delete(e.key.toLowerCase()));

/* browse grid */
const W=canvas.width,H=canvas.height;
const sophia={x:34,y:130,w:10,h:12,speed:0.9,run:1.25};

const movies=[
  "Neon Heartbreak",
  "The Audition Star",
  "Milo: Night Cat",
  "Lucas.exe",
  "City Spiral",
  "Violet Tape",
  "Dream Door",
  "Midnight Parking",
  "Shimmer Street",
  "Blue Cabinet",
  "Lost Keys",
  "Zero Hour",
  "The Gnome",
  "Hammock Moon",
  "Pingpong Ghost",
  "Shop of Mirrors",
];

const covers=[];
function buildCovers(){
  covers.length=0;
  let i=0;
  for(let row=0; row<4; row++){
    for(let col=0; col<4; col++){
      const x=70+col*58;
      const y=34+row*32;
      covers.push({id:i, title:movies[i%movies.length], x,y,w:44,h:26});
      i++;
    }
  }
}
buildCovers();

function rectsOverlap(ax,ay,aw,ah,bx,by,bw,bh){
  return ax<bx+bw && ax+aw>bx && ay<by+bh && ay+ah>by;
}
function nearestCover(){
  let best=null, bd=9999;
  const px=sophia.x+sophia.w/2, py=sophia.y+sophia.h/2;
  for(const c of covers){
    const cx=c.x+c.w/2, cy=c.y+c.h/2;
    const d=(cx-px)*(cx-px)+(cy-py)*(cy-py);
    if(d<bd && d<1300){ bd=d; best=c; }
  }
  return best;
}

function addMovie(c){
  const title=c.title;
  if(state.inventory.movies.includes(title)) return toast("Already picked.", 1100);
  state.inventory.movies.push(title);
  saveState(); sync();
  toast(`Picked: ${title}`, 1500);
}
function removeLast(){
  if(state.inventory.movies.length===0) return toast("Nothing to remove.", 1100);
  const x=state.inventory.movies.pop();
  saveState(); sync();
  toast(`Removed: ${x}`, 1300);
}

function drawBevel(x,y,w,h,fill){
  ctx.fillStyle=fill; ctx.fillRect(x,y,w,h);
  ctx.fillStyle="rgba(255,255,255,.08)"; ctx.fillRect(x,y,w,1);
  ctx.fillStyle="rgba(0,0,0,.35)"; ctx.fillRect(x,y+h-1,w,1);
  ctx.fillStyle="rgba(255,255,255,.06)"; ctx.fillRect(x,y,1,h);
  ctx.fillStyle="rgba(0,0,0,.35)"; ctx.fillRect(x+w-1,y,1,h);
}
function drawSophia(x,y){
  ctx.fillStyle="rgba(0,0,0,.45)"; ctx.fillRect(x-1,y+11,12,2);
  ctx.fillStyle="#f2d27a"; ctx.fillRect(x+1,y+0,8,4); ctx.fillRect(x+0,y+3,10,3);
  ctx.fillStyle="#ffd9c9"; ctx.fillRect(x+2,y+5,6,4);
  ctx.fillStyle="#67b7ff"; ctx.fillRect(x+3,y+6,1,1); ctx.fillRect(x+6,y+6,1,1);
  ctx.fillStyle="rgba(138,46,255,.55)"; ctx.fillRect(x+2,y+9,6,3);
  ctx.fillStyle="rgba(255,255,255,.14)"; ctx.fillRect(x+3,y+10,4,1);
}

function drawWorld(t){
  ctx.fillStyle="#05050a"; ctx.fillRect(0,0,W,H);

  // BIG BLUE/YELLOW brand wash
  const g=ctx.createRadialGradient(160,50,10,160,50,190);
  g.addColorStop(0,"rgba(23,70,255,.22)");
  g.addColorStop(0.55,"rgba(255,210,0,.12)");
  g.addColorStop(1,"rgba(0,0,0,0)");
  ctx.fillStyle=g; ctx.fillRect(0,0,W,H);

  // yellow stripe
  ctx.fillStyle="rgba(255,210,0,.12)";
  ctx.fillRect(0,18,W,10);

  // shelves
  for(let i=0;i<4;i++){
    drawBevel(58, 26+i*34, 252, 30, "rgba(255,255,255,.05)");
    ctx.fillStyle="rgba(0,0,0,.45)";
    ctx.fillRect(62, 30+i*34, 244, 22);
  }

  // covers
  const near=nearestCover();
  for(const c of covers){
    const picked = state.inventory.movies.includes(c.title);
    drawBevel(c.x,c.y,c.w,c.h, picked ? "rgba(255,210,0,.10)" : "rgba(23,70,255,.10)");
    ctx.fillStyle="rgba(0,0,0,.55)";
    ctx.fillRect(c.x+2,c.y+2,c.w-4,c.h-10);
    ctx.fillStyle="rgba(255,255,255,.10)";
    ctx.fillRect(c.x+2,c.y+c.h-7,c.w-4,5);

    if(near && near.id===c.id){
      ctx.fillStyle="rgba(255,210,0,.16)";
      ctx.fillRect(c.x-2,c.y-2,c.w+4,c.h+4);
    }
  }

  // exit door (left)
  drawBevel(0,70,18,40,"rgba(255,255,255,.06)");
  ctx.fillStyle="rgba(0,0,0,.55)"; ctx.fillRect(2,74,14,10);

  // hint
  if(near){
    ctx.font="8px ui-monospace, monospace";
    ctx.fillStyle="rgba(255,255,255,.80)";
    ctx.fillText(`E: PICK "${near.title}"`, 22, 168);
  }
}

/* loop */
let t=0;
function loop(){
  t++;

  // movement
  const run=keysDown.has("shift");
  const sp=0.9*(run?1.35:1);
  let dx=0,dy=0;
  if(keysDown.has("w")||keysDown.has("arrowup")) dy-=sp;
  if(keysDown.has("s")||keysDown.has("arrowdown")) dy+=sp;
  if(keysDown.has("a")||keysDown.has("arrowleft")) dx-=sp;
  if(keysDown.has("d")||keysDown.has("arrowright")) dx+=sp;
  if(dx&&dy){dx*=0.72; dy*=0.72;}
  sophia.x=clamp(sophia.x+dx, 12, W-12);
  sophia.y=clamp(sophia.y+dy, 22, H-14);

  // actions
  if(keysDown.has("e")){
    if(!loop._e){ loop._e=true;
      const c=nearestCover(); if(c) addMovie(c);
    }
  } else loop._e=false;

  if(keysDown.has("r")){
    if(!loop._r){ loop._r=true; removeLast(); }
  } else loop._r=false;

  if(keysDown.has("escape")){
    if(!loop._esc){ loop._esc=true; saveState(); location.href="street.html"; }
  } else loop._esc=false;

  drawWorld(t);
  drawSophia(Math.round(sophia.x), Math.round(sophia.y));

  requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>
