<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Sophia's Audition — Cat Store</title>
<style>
  :root{
    --bg:#07070b; --fg:#fff; --ui2:rgba(255,255,255,.14);
    --vio:#8a2eff; --aqua:#00ffd5; --hot:#ff63ff; --sun:#ffd24d;
  }
  html,body{height:100%;margin:0;background:var(--bg);color:var(--fg);
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;}
  .wrap{height:100%;display:grid;place-items:center;}
  canvas{width:min(980px, 100vw);height:auto;image-rendering:pixelated;image-rendering:crisp-edges;touch-action:none;}
  .hud{
    position:fixed;left:12px;right:12px;top:12px;z-index:6;
    display:flex;gap:10px;flex-wrap:wrap;pointer-events:none;
  }
  .pill{
    pointer-events:auto;border:1px solid var(--ui2);background:rgba(0,0,0,.32);
    backdrop-filter: blur(8px);
    border-radius:999px;padding:10px 12px;font-size:11px;
    letter-spacing:.18em;text-transform:uppercase;display:flex;gap:10px;align-items:center;
  }
  .pill b{letter-spacing:.22em}
  .toast{
    position:fixed;left:50%;bottom:16px;transform:translateX(-50%);
    border:1px solid var(--ui2);background:rgba(0,0,0,.55);
    border-radius:14px;padding:10px 12px;font-size:12px;letter-spacing:.08em;
    opacity:0;transition:.2s;max-width:min(920px, calc(100vw - 24px));text-align:center;z-index:7;
  }
  .toast.on{opacity:1}

  body::before{
    content:"";position:fixed;inset:-20%;pointer-events:none;
    background:
      radial-gradient(circle at 20% 18%, rgba(255,210,77,.20), transparent 58%),
      radial-gradient(circle at 78% 22%, rgba(0,255,213,.14), transparent 62%),
      radial-gradient(circle at 40% 85%, rgba(138,46,255,.12), transparent 62%),
      radial-gradient(circle at 90% 75%, rgba(255,99,255,.10), transparent 65%);
    filter:blur(44px) saturate(1.12);
  }

  .panel{
    position:fixed;right:12px;bottom:12px;z-index:8;
    width:min(420px, calc(100vw - 24px));
    border:1px solid var(--ui2);
    background:rgba(0,0,0,.48);
    backdrop-filter: blur(10px);
    border-radius:16px;
    padding:10px 12px;
    display:none;
  }
  .panel.on{display:block}
  .panel h3{margin:0 0 8px 0;font-size:11px;letter-spacing:.22em;text-transform:uppercase;opacity:.9}
  .row{display:flex;justify-content:space-between;gap:12px;font-size:12px;line-height:1.35;
    border-top:1px solid rgba(255,255,255,.08);padding:8px 0;}
  .row:first-of-type{border-top:0;padding-top:0}
  .k{opacity:.72;letter-spacing:.06em}
  .v{opacity:.95}
  .btns{display:flex;flex-wrap:wrap;gap:8px;margin-top:8px}
  .btn{
    border:1px solid rgba(255,255,255,.14);
    background:rgba(255,255,255,.06);
    padding:8px 10px;border-radius:999px;
    font-size:11px;letter-spacing:.16em;text-transform:uppercase;
    cursor:pointer;color:#fff;
  }
  .btn:hover{background:rgba(255,255,255,.10)}
</style>
</head>
<body>
  <div class="hud">
    <div class="pill"><b>SOPHIA</b> <span id="status">CAT STORE</span></div>
    <div class="pill">CASH: $<span id="cash">0</span></div>
    <div class="pill">MUSH: <span id="mush">0</span></div>
    <div class="pill">CAT: <span id="catName">MILO</span></div>
    <div class="pill">Move: WASD · Run: SHIFT · Interact: E · Customize: C · Back: B</div>
  </div>

  <div class="toast" id="toast"></div>

  <div class="panel" id="catPanel">
    <h3>Cat Customizer</h3>
    <div class="row"><div class="k">Coat</div><div class="v" id="coatVal">Silver</div></div>
    <div class="row"><div class="k">Eyes</div><div class="v" id="eyeVal">Aqua</div></div>
    <div class="row"><div class="k">Collar</div><div class="v" id="collarVal">Violet</div></div>
    <div class="row"><div class="k">Mood</div><div class="v" id="moodVal">Proud</div></div>
    <div class="btns">
      <button class="btn" id="coatBtn">Coat</button>
      <button class="btn" id="eyeBtn">Eyes</button>
      <button class="btn" id="collarBtn">Collar</button>
      <button class="btn" id="moodBtn">Mood</button>
      <button class="btn" id="saveBtn">Save</button>
      <button class="btn" id="closeBtn">Close</button>
    </div>
  </div>

  <div class="wrap"><canvas id="c" width="320" height="180"></canvas></div>

<script>
const canvas=document.getElementById('c');
const ctx=canvas.getContext('2d',{alpha:false});
ctx.imageSmoothingEnabled=false;

const UI={
  toast:document.getElementById('toast'),
  cash:document.getElementById('cash'),
  mush:document.getElementById('mush'),
  catName:document.getElementById('catName'),
  panel:document.getElementById('catPanel'),
  coatVal:document.getElementById('coatVal'),
  eyeVal:document.getElementById('eyeVal'),
  collarVal:document.getElementById('collarVal'),
  moodVal:document.getElementById('moodVal'),
};

function toast(msg,ms=1400){
  UI.toast.textContent=msg;
  UI.toast.classList.add('on');
  clearTimeout(toast._t);
  toast._t=setTimeout(()=>UI.toast.classList.remove('on'),ms);
}

const STORE_KEY="SOPHIA_AUDITION_SAVE_V1";
function loadState(){
  const r=localStorage.getItem(STORE_KEY);
  if(r){ try{return JSON.parse(r);}catch(e){} }
  return {
    cash:0,
    street:{mush:0},
    sophia:{x:150,y:120},
    milo:{x:135,y:130},
    cat:{ coat:0, eyes:0, collar:0, mood:0, name:"MILO" },
    lastRoom:"CATSTORE"
  };
}
function saveState(){ localStorage.setItem(STORE_KEY, JSON.stringify(state)); }
let state=loadState();
state.street=state.street||{mush:0};
state.cat=state.cat||{coat:0,eyes:0,collar:0,mood:0,name:"MILO"};

UI.cash.textContent=state.cash|0;
UI.mush.textContent=state.street.mush|0;
UI.catName.textContent=state.cat.name||"MILO";

const coats=["Silver","Black","Ginger","White","Calico","Shadow"];
const eyes=["Aqua","Gold","Violet","Green","Ice"];
const collars=["Violet","Aqua","Sun","Hot Pink","Black"];
const moods=["Proud","Silly","Judgmental","Sleepy","Chaos","Angel"];

function syncPanel(){
  UI.coatVal.textContent=coats[state.cat.coat%coats.length];
  UI.eyeVal.textContent=eyes[state.cat.eyes%eyes.length];
  UI.collarVal.textContent=collars[state.cat.collar%collars.length];
  UI.moodVal.textContent=moods[state.cat.mood%moods.length];
}

let panelOpen=false;
function togglePanel(on){
  panelOpen = (typeof on==="boolean") ? on : !panelOpen;
  UI.panel.classList.toggle("on", panelOpen);
  if(panelOpen) syncPanel();
}

document.getElementById('coatBtn').onclick=()=>{state.cat.coat=(state.cat.coat+1)%coats.length;syncPanel();};
document.getElementById('eyeBtn').onclick=()=>{state.cat.eyes=(state.cat.eyes+1)%eyes.length;syncPanel();};
document.getElementById('collarBtn').onclick=()=>{state.cat.collar=(state.cat.collar+1)%collars.length;syncPanel();};
document.getElementById('moodBtn').onclick=()=>{state.cat.mood=(state.cat.mood+1)%moods.length;syncPanel();};
document.getElementById('saveBtn').onclick=()=>{saveState();toast("Saved. Milo is now illegally stylish.",1600);};
document.getElementById('closeBtn').onclick=()=>togglePanel(false);

/* Input */
const keysDown=new Set();
addEventListener('keydown',(e)=>{
  const k=e.key.toLowerCase();
  if(["arrowup","arrowdown","arrowleft","arrowright"," ","shift","w","a","s","d","e","c","b"].includes(k)) e.preventDefault();
  keysDown.add(k);
});
addEventListener('keyup',(e)=>keysDown.delete(e.key.toLowerCase()));

const clamp=(v,a,b)=>Math.max(a,Math.min(b,v));
const lerp=(a,b,t)=>a+(b-a)*t;

const WORLD={w:560,h:360};
const sophia={x:state.sophia?.x||160,y:state.sophia?.y||190,w:10,h:12, speed:70, run:110};
const milo={x:state.milo?.x||140,y:state.milo?.y||205,w:8,h:8};
const cam={x:0,y:0};

const solids=[];
function addSolid(x,y,w,h){solids.push([x,y,w,h]);}
addSolid(-50,-50,WORLD.w+100,50);
addSolid(-50,WORLD.h,WORLD.w+100,50);
addSolid(-50,-50,50,WORLD.h+100);
addSolid(WORLD.w,-50,50,WORLD.h+100);
// counters/walls
addSolid(40,60,480,14);
addSolid(40,60,14,240);
addSolid(506,60,14,240);
addSolid(40,286,480,14);
addSolid(210,190,140,18); // counter
addSolid(220,130,120,22); // shelf
addSolid(80,120,90,18);   // cat toys
addSolid(390,120,90,18);  // cat food

function rectsOverlap(ax,ay,aw,ah,bx,by,bw,bh){
  return ax<bx+bw && ax+aw>bx && ay<by+bh && ay+ah>by;
}
function collides(x,y,w,h){
  for(const s of solids){ if(rectsOverlap(x,y,w,h,s[0],s[1],s[2],s[3])) return true; }
  return false;
}
function tryMove(ent,dx,dy){
  const nx=ent.x+dx, ny=ent.y+dy;
  if(!collides(nx,ent.y,ent.w,ent.h)) ent.x=nx;
  if(!collides(ent.x,ny,ent.w,ent.h)) ent.y=ny;
  ent.x=clamp(ent.x,0,WORLD.w-ent.w);
  ent.y=clamp(ent.y,0,WORLD.h-ent.h);
}

function goBack(){
  // You said you’ll wire returns later, but we keep B as a safe “back” if street exists.
  state.sophia={x:sophia.x,y:sophia.y};
  state.milo={x:milo.x,y:milo.y};
  state.lastRoom="CATSTORE";
  saveState();
  location.href="street.html";
}

/* Interact zones */
const zones=[
  {name:"CUSTOMIZE COUNTER", x:210,y:176,w:140,h:26, act:()=>{togglePanel(true); toast("Customizer open.",1100);} },
  {name:"NAME TAG", x:120,y:248,w:60,h:18, act:()=>{state.cat.name="MILO"; UI.catName.textContent="MILO"; toast("Name tag: MILO.",1100); saveState();} },
  {name:"LUCKY CHARM", x:410,y:248,w:60,h:18, act:()=>{
    if(state.cash<5) return toast("Charm costs $5.",1100);
    state.cash-=5; UI.cash.textContent=state.cash|0;
    state.street.mush=(state.street.mush|0)+1; UI.mush.textContent=state.street.mush|0;
    toast("Charm acquired. +1 mush (don’t ask why).",1500);
    saveState();
  }},
];

function nearestZone(){
  const px=sophia.x+sophia.w/2, py=sophia.y+sophia.h/2;
  let best=null,bd=1e12;
  for(const z of zones){
    const cx=z.x+z.w/2, cy=z.y+z.h/2;
    const d=(px-cx)*(px-cx)+(py-cy)*(py-cy);
    if(d<bd && d<2200){ best=z; bd=d; }
  }
  return best;
}

function drawRectBevel(x,y,w,h,fill){
  ctx.fillStyle=fill; ctx.fillRect(x,y,w,h);
  ctx.fillStyle="rgba(255,255,255,.10)"; ctx.fillRect(x,y,w,1);
  ctx.fillStyle="rgba(0,0,0,.40)"; ctx.fillRect(x,y+h-1,w,1);
  ctx.fillStyle="rgba(255,255,255,.07)"; ctx.fillRect(x,y,1,h);
  ctx.fillStyle="rgba(0,0,0,.45)"; ctx.fillRect(x+w-1,y,1,h);
}
function drawHintBubble(text,x,y){
  const pad=3;
  ctx.font="8px ui-monospace, monospace";
  const m=ctx.measureText(text);
  const w=Math.ceil(m.width)+pad*2, h=12;
  ctx.fillStyle="rgba(0,0,0,.70)";
  ctx.fillRect(x-w/2,y-h,w,h);
  ctx.strokeStyle="rgba(255,255,255,.16)";
  ctx.strokeRect(x-w/2+0.5,y-h+0.5,w-1,h-1);
  ctx.fillStyle="rgba(255,255,255,.92)";
  ctx.fillText(text,x-w/2+pad,y-4);
}

function drawSophia(vx,vy){
  const x=vx,y=vy;
  ctx.fillStyle="rgba(0,0,0,.22)"; ctx.fillRect(x-1,y+11,12,2);
  ctx.fillStyle="#f2d27a"; ctx.fillRect(x+1,y+0,8,4); ctx.fillRect(x+0,y+3,10,3);
  ctx.fillStyle="#ffd9c9"; ctx.fillRect(x+2,y+5,6,4);
  ctx.fillStyle="#67b7ff"; ctx.fillRect(x+3,y+6,1,1); ctx.fillRect(x+6,y+6,1,1);
  ctx.fillStyle="rgba(138,46,255,.70)"; ctx.fillRect(x+2,y+9,6,3);
  ctx.fillStyle="rgba(255,255,255,.18)"; ctx.fillRect(x+3,y+10,4,1);
}
function drawMilo(vx,vy){
  const x=vx,y=vy;
  ctx.fillStyle="rgba(0,0,0,.20)"; ctx.fillRect(x-1,y+7,10,2);

  // coat palette from state
  const coat = state.cat.coat%coats.length;
  let body="#d8d8d8";
  if(coat===1) body="#5e5e66";
  if(coat===2) body="#e0a35a";
  if(coat===3) body="#f1f1f1";
  if(coat===4) body="#d8d8d8";
  if(coat===5) body="#2b2b33";

  ctx.fillStyle=body; ctx.fillRect(x+1,y+2,6,5);
  ctx.fillStyle="rgba(255,255,255,.12)"; ctx.fillRect(x+1,y+1,2,2); ctx.fillRect(x+5,y+1,2,2);

  // eyes palette
  const e = state.cat.eyes%eyes.length;
  let eye="#1affd3";
  if(e===1) eye="#ffd24d";
  if(e===2) eye="#8a2eff";
  if(e===3) eye="#58ff7a";
  if(e===4) eye="#cfe9ff";
  ctx.fillStyle=eye; ctx.fillRect(x+2,y+4,1,1); ctx.fillRect(x+5,y+4,1,1);

  // collar
  const c = state.cat.collar%collars.length;
  let col="rgba(138,46,255,.75)";
  if(c===1) col="rgba(0,255,213,.65)";
  if(c===2) col="rgba(255,210,77,.70)";
  if(c===3) col="rgba(255,99,255,.70)";
  if(c===4) col="rgba(255,255,255,.12)";
  ctx.fillStyle=col; ctx.fillRect(x+1,y+6,6,1);

  ctx.fillStyle="rgba(0,0,0,.30)"; ctx.fillRect(x+7,y+3,1,3);
}

let last=performance.now();
let t=0;
let eWas=false,cWas=false,bWas=false;

function loop(){
  const now=performance.now();
  const dt=Math.max(0, Math.min(0.05, (now-last)/1000));
  last=now; t++;

  // Controls
  if(!panelOpen){
    const run=keysDown.has("shift");
    const sp=(run?sophia.run:sophia.speed);
    let dx=0,dy=0;
    if(keysDown.has("w")||keysDown.has("arrowup")) dy-=sp*dt;
    if(keysDown.has("s")||keysDown.has("arrowdown")) dy+=sp*dt;
    if(keysDown.has("a")||keysDown.has("arrowleft")) dx-=sp*dt;
    if(keysDown.has("d")||keysDown.has("arrowright")) dx+=sp*dt;
    if(dx&&dy){dx*=0.72;dy*=0.72;}
    if(dx||dy) tryMove(sophia,dx,dy);

    // Milo follow
    const tx=sophia.x-10, ty=sophia.y+6;
    milo.x += (tx-milo.x)*0.09*(dt*60);
    milo.y += (ty-milo.y)*0.09*(dt*60);
  }

  const e=keysDown.has("e");
  if(e && !eWas && !panelOpen){
    const z=nearestZone();
    if(z){ z.act(); }
    else toast("Meow. (Nothing to interact with here.)",1200);
  }
  eWas=e;

  const c=keysDown.has("c");
  if(c && !cWas){ togglePanel(); if(panelOpen) toast("Customizer open.",1000); }
  cWas=c;

  const b=keysDown.has("b");
  if(b && !bWas){ goBack(); }
  bWas=b;

  // Camera (soft)
  cam.x += ((sophia.x-160) - cam.x)*0.14*(dt*60);
  cam.y += ((sophia.y-90) - cam.y)*0.14*(dt*60);
  cam.x=clamp(cam.x,0,WORLD.w-320);
  cam.y=clamp(cam.y,0,WORLD.h-180);

  // Draw
  ctx.fillStyle="rgba(160,215,255,1)"; ctx.fillRect(0,0,320,180);
  ctx.fillStyle="rgba(255,255,255,.08)";
  for(let i=0;i<24;i++) ctx.fillRect((i*18 + (t*2|0))%320, 18+(i%6)*6, 14, 2);

  // floor
  ctx.fillStyle="rgba(240,240,245,1)"; ctx.fillRect(0,0,320,180);
  ctx.fillStyle="rgba(0,0,0,.06)";
  for(let y=0;y<180;y+=8) ctx.fillRect(0,y,320,1);

  // walls/counters
  const ox=-cam.x, oy=-cam.y;
  function W(x,y){return [Math.round(x+ox),Math.round(y+oy)]}
  // room border
  drawRectBevel(40+ox,60+oy,480,240,"rgba(255,255,255,.16)");
  ctx.fillStyle="rgba(0,0,0,.18)"; ctx.fillRect(42+ox,62+oy,476,236);

  // shelves + props
  drawRectBevel(220+ox,130+oy,120,22,"rgba(255,99,255,.14)");
  drawRectBevel(80+ox,120+oy,90,18,"rgba(0,255,213,.12)");
  drawRectBevel(390+ox,120+oy,90,18,"rgba(255,210,77,.12)");
  drawRectBevel(210+ox,190+oy,140,18,"rgba(138,46,255,.14)");

  ctx.font="8px ui-monospace, monospace";
  ctx.fillStyle="rgba(255,255,255,.92)";
  ctx.fillText("CAT STORE", 56+ox, 78+oy);
  ctx.fillStyle="rgba(255,255,255,.82)";
  ctx.fillText("CUSTOMIZER COUNTER", 216+ox, 202+oy);
  ctx.fillText("TOYS", 96+ox, 134+oy);
  ctx.fillText("FOOD", 410+ox, 134+oy);

  // zones markers
  ctx.fillStyle="rgba(255,210,77,.16)";
  ctx.fillRect(120+ox,248+oy,60,18);
  ctx.fillStyle="rgba(0,255,213,.14)";
  ctx.fillRect(410+ox,248+oy,60,18);
  ctx.fillStyle="rgba(255,255,255,.80)";
  ctx.fillText("NAME TAG", 128+ox, 260+oy);
  ctx.fillText("CHARM", 424+ox, 260+oy);

  // Draw Milo + Sophia
  drawMilo(Math.round(milo.x+ox), Math.round(milo.y+oy));
  drawSophia(Math.round(sophia.x+ox), Math.round(sophia.y+oy));

  // hint
  const z=(!panelOpen)?nearestZone():null;
  if(z){
    const hx=Math.round((sophia.x+6)+ox);
    const hy=Math.round((sophia.y-10)+oy);
    drawHintBubble(z.name, hx, hy);
  }

  // mood sparkle
  const mood=state.cat.mood%moods.length;
  if(mood===2){ // judgmental
    ctx.fillStyle="rgba(0,0,0,.12)"; ctx.fillRect(0,0,320,180);
  }
  if(mood===4){ // chaos
    ctx.fillStyle=`rgba(255,99,255,${0.06 + 0.04*Math.sin(t*0.12)})`;
    ctx.fillRect(0,0,320,180);
  }

  // autosave
  if((t%30)===0){
    state.sophia={x:sophia.x,y:sophia.y};
    state.milo={x:milo.x,y:milo.y};
    saveState();
  }

  requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>
