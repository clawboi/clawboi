<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Sophia's Audition 01 — Bedroom</title>
<style>
:root{ --bg:#07070b; --fg:#fff; --ui:rgba(255,255,255,.08); --ui2:rgba(255,255,255,.14); --vio:#8a2eff;}
html,body{height:100%; margin:0; background:var(--bg); color:var(--fg); font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;}
.wrap{height:100%; display:grid; place-items:center;}
canvas{width:min(980px, 100vw); height:auto; image-rendering:pixelated; image-rendering:crisp-edges; touch-action:none;}

body::before{
content:"";
position:fixed;
inset:-20%;
background:
radial-gradient(circle at 20% 10%, rgba(138,46,255,.18), transparent 60%),
radial-gradient(circle at 80% 40%, rgba(0,255,213,.12), transparent 65%);
filter:blur(40px);
animation:drift 12s ease-in-out infinite;
pointer-events:none;
}
@keyframes drift{
0%,100%{transform:translate3d(0,0,0)}
50%{transform:translate3d(1.5%, -1.5%,0)}
}

.hud{
position:fixed; left:12px; right:12px; top:12px; z-index:5;
display:flex; gap:10px; align-items:flex-start; flex-wrap:wrap;
pointer-events:none;
}
.pill{
pointer-events:auto;
border:1px solid var(--ui2); background:rgba(0,0,0,.35);
backdrop-filter: blur(8px);
border-radius:999px; padding:10px 12px;
font-size:11px; letter-spacing:.18em; text-transform:uppercase;
display:flex; gap:10px; align-items:center;
}
.pill b{letter-spacing:.22em}
.hint{
pointer-events:auto;
flex:1 1 260px;
border:1px solid var(--ui2); background:rgba(0,0,0,.35);
backdrop-filter: blur(8px);
border-radius:18px; padding:10px 12px;
font-size:11px; letter-spacing:.10em; line-height:1.35;
}
.hint .k{display:inline-block; padding:2px 7px; border-radius:8px; border:1px solid var(--ui2); background:rgba(255,255,255,.06); font-weight:700}
.toast{
position:fixed; left:50%; bottom:16px; transform:translateX(-50%);
border:1px solid var(--ui2); background:rgba(0,0,0,.55);
border-radius:14px; padding:10px 12px;
font-size:12px; letter-spacing:.08em; opacity:0; transition:.2s;
max-width:min(720px, calc(100vw - 24px)); text-align:center;
}
.toast.on{opacity:1}

/* poem modal */
#poemBox{
position:fixed;
inset:0;
display:none;
place-items:center;
background:rgba(0,0,0,.6);
z-index:9;
}
#poemBox textarea{
width:300px;height:180px;
background:#0b0b12;
color:#fff;
border:1px solid var(--ui2);
padding:10px;
font-family:monospace;
}
#poemBox button{
margin-top:6px;
background:var(--vio);
border:none;
color:white;
padding:6px 14px;
cursor:pointer;
}

/* NEW: wardrobe overlay (same page, not a new html) */
#wardrobeBox{
position:fixed;
inset:0;
display:none;
place-items:center;
background:rgba(0,0,0,.62);
z-index:10;
}
#wardrobeBox .panel{
width:min(360px, calc(100vw - 28px));
border:1px solid var(--ui2);
background:rgba(8,8,14,.72);
backdrop-filter: blur(10px);
border-radius:18px;
padding:12px 12px 10px;
}
#wardrobeBox .title{
font-size:11px;
letter-spacing:.22em;
text-transform:uppercase;
opacity:.9;
margin:2px 0 10px;
}
#wardrobeBox .row{
display:flex;
gap:10px;
flex-wrap:wrap;
margin:8px 0 10px;
align-items:center;
}
#wardrobeBox .label{
font-size:11px;
letter-spacing:.12em;
opacity:.75;
min-width:72px;
}
.swatch{
width:26px;height:26px;border-radius:10px;
border:1px solid rgba(255,255,255,.18);
cursor:pointer;
box-shadow:0 0 18px rgba(138,46,255,.10);
}
#wardrobeBox .btnRow{display:flex; justify-content:flex-end; gap:10px; margin-top:6px;}
#wardrobeBox button{
background:rgba(255,255,255,.08);
border:1px solid rgba(255,255,255,.16);
color:#fff;
padding:8px 12px;
border-radius:12px;
cursor:pointer;
font-size:11px;
letter-spacing:.12em;
}
#wardrobeBox button.primary{
background:var(--vio);
border-color:transparent;
}

</style>
</head>
<body>

<div class="hud">
<div class="pill"><b>SOPHIA</b> <span id="status">BEDROOM</span></div>
<div class="pill">MILO: <span id="miloMood">following</span></div>
<div class="pill">KEYS: <span id="keys">NO</span></div>
<div class="hint">
Move: <span class="k">WASD</span> · Interact: <span class="k">E</span> · Run: <span class="k">SHIFT</span><br>
Desk = write poetry · Guitar = play · Clothes = change outfit · Bed = sleep · Doors lead out
</div>
</div>

<div class="toast" id="toast"></div>

<div id="poemBox">
<div>
<textarea id="poemInput" placeholder="Write poetry..."></textarea><br>
<button onclick="savePoem()">Save Line</button>
</div>
</div>

<!-- NEW: wardrobe (dress + shoes colors) -->
<div id="wardrobeBox" aria-hidden="true">
  <div class="panel">
    <div class="title">Wardrobe</div>

    <div class="row">
      <div class="label">Dress</div>
      <div class="swatch" data-dress="#a64dff" style="background:#a64dff"></div>
      <div class="swatch" data-dress="#4dffcf" style="background:#4dffcf"></div>
      <div class="swatch" data-dress="#ff4d88" style="background:#ff4d88"></div>
      <div class="swatch" data-dress="#ffd24d" style="background:#ffd24d"></div>
      <div class="swatch" data-dress="#9aa0ff" style="background:#9aa0ff"></div>
      <div class="swatch" data-dress="#6bff7c" style="background:#6bff7c"></div>
    </div>

    <div class="row">
      <div class="label">Shoes</div>
      <div class="swatch" data-shoes="#ffffff" style="background:#ffffff"></div>
      <div class="swatch" data-shoes="#111111" style="background:#111111"></div>
      <div class="swatch" data-shoes="#8a2eff" style="background:#8a2eff"></div>
      <div class="swatch" data-shoes="#00ffd5" style="background:#00ffd5"></div>
      <div class="swatch" data-shoes="#ff3b6b" style="background:#ff3b6b"></div>
      <div class="swatch" data-shoes="#ffd24d" style="background:#ffd24d"></div>
    </div>

    <div class="btnRow">
      <button id="wardrobeClose">Close</button>
      <button class="primary" id="wardrobeDone">Done</button>
    </div>
  </div>
</div>

<div class="wrap"><canvas id="c" width="320" height="180"></canvas></div>

<script>
const canvas=c;
const ctx=canvas.getContext("2d",{alpha:false});
ctx.imageSmoothingEnabled=false;

const STORE_KEY="SOPHIA_AUDITION_SAVE_V1";

let state=JSON.parse(localStorage.getItem(STORE_KEY)||`{
"hasKeys":false,"slept":false,"trip":false,"puke":false,
"poemLines":0,"poems":[],"guitarPlayed":0,
"outfit":0,
"dressColor":"#a64dff",
"shoeColor":"#ffffff",
"lastRoom":"BEDROOM",
"sophia":{"x":160,"y":120},
"milo":{"x":148,"y":132}
}`);

function save(){localStorage.setItem(STORE_KEY,JSON.stringify(state));}

const W=320,H=180;

/* ---------- controls ---------- */
const keysDown=new Set();
onkeydown=e=>{keysDown.add(e.key.toLowerCase());}
onkeyup=e=>keysDown.delete(e.key.toLowerCase());

/* ---------- solids ---------- */
const solids=[
[0,0,W,10],[0,0,10,H],[0,H-10,W,10],[W-10,0,10,H],
[38,48,90,34],
[210,42,78,42],
[52,118,22,30],
[132,86,56,18],
[90,130,40,20]
];

/* ---------- zones ---------- */
const zones=[
/* Desk -> poetry.html (no layout change, just route) */
{name:"DESK",rect:[44,52,78,26],action:()=>go("poetry.html")},
/* Bed -> bed.html (route) */
{name:"BED",rect:[216,46,66,34],action:()=>go("bed.html")},
/* Guitar -> guitar.html already */
{name:"GUITAR",rect:[48,122,32,26],action:()=>go("guitar.html")},
/* Clothes -> wardrobe overlay (not a new html) */
{name:"CLOTHES",rect:[90,130,40,20],action:openWardrobe},
/* doors */
{name:"DOOR_BATH",rect:[0,78,14,28],action:()=>go("bathroom.html")},
{name:"DOOR_LIVING",rect:[W-24,78,14,28],action:()=>go("Sophie03.html")},
{name:"DOOR_YARD",rect:[154,H-20,34,10],action:()=>go("Sophie02.html")}
];

/* ---------- wardrobe ---------- */
const wardrobeBox=document.getElementById("wardrobeBox");
function openWardrobe(){
  wardrobeBox.style.display="grid";
  wardrobeBox.setAttribute("aria-hidden","false");
  toast("Wardrobe open. Pick dress + shoes.");
}
function closeWardrobe(){
  wardrobeBox.style.display="none";
  wardrobeBox.setAttribute("aria-hidden","true");
}
document.getElementById("wardrobeClose").onclick=closeWardrobe;
document.getElementById("wardrobeDone").onclick=()=>{ closeWardrobe(); toast("Outfit set."); };

wardrobeBox.addEventListener("click",(e)=>{
  if(e.target===wardrobeBox) closeWardrobe();
  const d=e.target.getAttribute && e.target.getAttribute("data-dress");
  const s=e.target.getAttribute && e.target.getAttribute("data-shoes");
  if(d){
    state.dressColor=d; save();
    toast("Dress color changed.");
  }
  if(s){
    state.shoeColor=s; save();
    toast("Shoe color changed.");
  }
});

/* ---------- poem (kept, even though desk routes to poetry.html now) ---------- */
function savePoem(){
const t=document.getElementById("poemInput");
if(!t.value.trim())return;
state.poems.push(t.value.trim());
state.poemLines++;
t.value="";
save();
poemBox.style.display="none";
toast("Poetry saved.");
}

/* ---------- movement + jump/dance ---------- */
const sophia={x:state.sophia.x,y:state.sophia.y,w:10,h:12};
const milo={x:state.milo.x,y:state.milo.y};

let jumpV=0;      // vertical velocity
let jumpZ=0;      // vertical offset (visual only)
let onGround=true;

let danceT=0;     // dance timer frames
let dust=[];

function col(x,y,w,h){
for(const s of solids){
if(x<s[0]+s[2]&&x+w>s[0]&&y<s[1]+s[3]&&y+h>s[1])return true;
}
return false;
}
function move(dx,dy){
if(!col(sophia.x+dx,sophia.y,sophia.w,sophia.h))sophia.x+=dx;
if(!col(sophia.x,sophia.y+dy,sophia.w,sophia.h))sophia.y+=dy;
}

function doJump(){
  if(!onGround) return;
  onGround=false;
  jumpV=-2.8;
  toast("Jump!");
  for(let i=0;i<6;i++){
    dust.push({x:sophia.x+2+Math.random()*6,y:sophia.y+12, vx:(Math.random()*1.4-0.7), vy:(Math.random()*-1.1), life:18+Math.random()*10});
  }
}

function doDance(){
  danceT = 58; // ~1 sec at 60fps
  toast("Dance!");
}

/* ---------- interact ---------- */
function nearest(){
let best=null,bd=9999;
for(const z of zones){
let cx=z.rect[0]+z.rect[2]/2;
let cy=z.rect[1]+z.rect[3]/2;
let d=(cx-sophia.x)**2+(cy-sophia.y)**2;
if(d<bd&&d<1400){bd=d;best=z;}
}
return best;
}

function interact(){
let z=nearest();
if(z)z.action();
}

/* ---------- toast ---------- */
function toast(msg){
toastEl.textContent=msg;
toastEl.classList.add("on");
setTimeout(()=>toastEl.classList.remove("on"),1500);
}
const toastEl=document.getElementById("toast");

/* ---------- milo ---------- */
function updateMilo(){
let tx=sophia.x-12,ty=sophia.y+6;
milo.x+= (tx-milo.x)*.05;
milo.y+= (ty-milo.y)*.05;

if(Math.random()<.002) meow();
}
function meow(){
toast("Milo: meow (he wants outside)");
}

/* ---------- NEW: on-object proximity label + bottom nav hint (no layout change) ---------- */
function drawHintBubble(text,x,y){
  const pad=3;
  ctx.font="8px ui-monospace, monospace";
  const m=ctx.measureText(text);
  const w=Math.ceil(m.width)+pad*2, h=12;
  const bx=((x-w/2)|0), by=((y-h)|0);
  ctx.fillStyle="rgba(0,0,0,.68)"; ctx.fillRect(bx,by,w,h);
  ctx.strokeStyle="rgba(255,255,255,.14)"; ctx.strokeRect(bx+0.5,by+0.5,w-1,h-1);
  ctx.fillStyle="rgba(255,255,255,.92)"; ctx.fillText(text,(bx+pad)|0,(by+8)|0);
}
function zonePrettyName(z){
  if(!z) return "";
  if(z.name==="DOOR_BATH") return "DOOR → BATHROOM";
  if(z.name==="DOOR_LIVING") return "DOOR → LIVING ROOM";
  if(z.name==="DOOR_YARD") return "DOOR → YARD";
  if(z.name==="DESK") return "DESK (poetry)";
  if(z.name==="BED") return "BED (sleep)";
  if(z.name==="GUITAR") return "GUITAR (play)";
  if(z.name==="CLOTHES") return "CLOTHES (wardrobe)";
  return z.name;
}
function showZoneToast(z){
  if(!z) return;
  // tiny anti-spam: only toast when changed
  if(showZoneToast._last===z.name) return;
  showZoneToast._last=z.name;
  toast(zonePrettyName(z));
}

/* ---------- render polish helpers ---------- */
function pxNoiseStripe(y, a){
  ctx.fillStyle=`rgba(255,255,255,${a})`;
  ctx.fillRect(10,y,W-20,1);
}
function vignette(){
  // subtle vignette without gradients heavy
  ctx.fillStyle="rgba(0,0,0,.22)";
  ctx.fillRect(0,0,W,12);
  ctx.fillRect(0,H-12,W,12);
  ctx.fillRect(0,0,12,H);
  ctx.fillRect(W-12,0,12,H);
}

/* ---------- render ---------- */
function bg(){
ctx.fillStyle="#05050a";
ctx.fillRect(0,0,W,H);

/* extra depth: faint violet + cyan haze */
let g1=ctx.createRadialGradient(82,58,12,82,58,170);
g1.addColorStop(0,"rgba(138,46,255,.22)");
g1.addColorStop(1,"transparent");
ctx.fillStyle=g1; ctx.fillRect(0,0,W,H);

let g2=ctx.createRadialGradient(250,40,10,250,40,170);
g2.addColorStop(0,"rgba(0,255,213,.10)");
g2.addColorStop(1,"transparent");
ctx.fillStyle=g2; ctx.fillRect(0,0,W,H);

/* window glow band */
ctx.fillStyle="rgba(255,255,255,.045)";
ctx.fillRect(10,10,W-20,80);

/* more “alive” floor */
for(let y=92;y<H-10;y++){
  if(y%6===0) pxNoiseStripe(y,.085);
  else if(y%3===0) pxNoiseStripe(y,.040);
}

/* tiny sparkles (subtle) */
if(Math.random()<.22){
  const sx=12+Math.random()*(W-24);
  const sy=14+Math.random()*72;
  ctx.fillStyle="rgba(255,255,255,.08)";
  ctx.fillRect(sx,sy,1,1);
}

/* furniture blocks (same layout, upgraded shading + color accents) */
drawBed(210,42,78,42);
drawDesk(38,48,90,34);
drawGuitarStand(52,118,22,30);
drawShelf(132,86,56,18);
drawCloset(90,130,40,20);

// bathroom door hint strip (left wall)
ctx.fillStyle="rgba(255,255,255,.04)";
ctx.fillRect(0,74,10,40);
ctx.fillStyle="rgba(138,46,255,.10)";
ctx.fillRect(1,78,6,26);

/* small rug accent */
ctx.fillStyle="rgba(138,46,255,.07)";
ctx.fillRect(122,132,74,28);
ctx.fillStyle="rgba(255,255,255,.05)";
ctx.fillRect(124,134,70,24);

vignette();

/* NEW: draw proximity label on the actual object when near */
const z=nearest();
if(z){
  const cx=z.rect[0]+z.rect[2]/2;
  const cy=z.rect[1]-2; // above object
  drawHintBubble("E • " + zonePrettyName(z), cx, cy);
}
}

function rect(x,y,w,h){
ctx.fillStyle="rgba(255,255,255,.07)";
ctx.fillRect(x,y,w,h);
}

function drawBed(x,y,w,h){
  // base
  ctx.fillStyle="rgba(255,255,255,.065)";
  ctx.fillRect(x,y,w,h);
  // headboard
  ctx.fillStyle="rgba(255,255,255,.085)";
  ctx.fillRect(x+2,y+2,w-4,10);
  // blanket tint
  ctx.fillStyle="rgba(138,46,255,.08)";
  ctx.fillRect(x+3,y+14,w-6,h-18);
  // pillow hint
  ctx.fillStyle="rgba(255,255,255,.10)";
  ctx.fillRect(x+8,y+6,14,5);
  ctx.fillRect(x+24,y+6,14,5);
  // outline
  ctx.fillStyle="rgba(0,0,0,.18)";
  ctx.fillRect(x,y+h-1,w,1);
  ctx.fillRect(x+w-1,y,1,h);
}

function drawDesk(x,y,w,h){
  ctx.fillStyle="rgba(255,255,255,.06)";
  ctx.fillRect(x,y,w,h);
  // top highlight
  ctx.fillStyle="rgba(255,255,255,.09)";
  ctx.fillRect(x+2,y+2,w-4,6);
  // notebook/poetry glow
  ctx.fillStyle="rgba(0,255,213,.06)";
  ctx.fillRect(x+8,y+10,20,10);
  ctx.fillStyle="rgba(255,255,255,.07)";
  ctx.fillRect(x+9,y+11,18,8);
  // lamp violet dot
  ctx.fillStyle="rgba(138,46,255,.16)";
  ctx.fillRect(x+w-14,y+8,6,6);
  // legs
  ctx.fillStyle="rgba(255,255,255,.05)";
  ctx.fillRect(x+8,y+h-10,6,8);
  ctx.fillRect(x+w-14,y+h-10,6,8);
}

function drawGuitarStand(x,y,w,h){
  ctx.fillStyle="rgba(255,255,255,.06)";
  ctx.fillRect(x,y,w,h);
  // tiny neon strap
  ctx.fillStyle="rgba(255,77,136,.10)";
  ctx.fillRect(x+3,y+6,w-6,2);
}

function drawShelf(x,y,w,h){
  ctx.fillStyle="rgba(255,255,255,.055)";
  ctx.fillRect(x,y,w,h);
  // books
  const bx=x+4, by=y+4;
  const cols=["rgba(138,46,255,.14)","rgba(0,255,213,.10)","rgba(255,210,77,.10)","rgba(255,255,255,.09)"];
  for(let i=0;i<6;i++){
    ctx.fillStyle=cols[i%cols.length];
    ctx.fillRect(bx+i*8,by,6,h-8);
  }
}

function drawCloset(x,y,w,h){
  ctx.fillStyle="rgba(255,255,255,.055)";
  ctx.fillRect(x,y,w,h);
  // door split
  ctx.fillStyle="rgba(255,255,255,.06)";
  ctx.fillRect(x+w/2-1,y+2,2,h-4);
  // tiny hanger glow
  ctx.fillStyle="rgba(0,255,213,.07)";
  ctx.fillRect(x+6,y+6,w-12,2);
}

/* ---------- dust fx ---------- */
function updateDust(){
  for(const p of dust){
    p.x+=p.vx;
    p.y+=p.vy;
    p.vy+=0.08;
    p.life-=1;
  }
  dust=dust.filter(p=>p.life>0);
}
function drawDust(){
  for(const p of dust){
    ctx.fillStyle=`rgba(255,255,255,${Math.max(0,Math.min(.12,p.life/80))})`;
    ctx.fillRect(p.x|0,p.y|0,1,1);
  }
}

/* sophia sprite */
function drawSophia(){
let x=sophia.x,y=sophia.y;

/* visual-only jump offset */
const z = jumpZ|0;
y = y + z;

/* head/hair */
ctx.fillStyle="#f2d27a";
ctx.fillRect(x+1,y,8,4);
ctx.fillRect(x,y+3,10,3);

/* face */
ctx.fillStyle="#ffd9c9";
ctx.fillRect(x+2,y+5,6,4);

/* eyes */
ctx.fillStyle="#67b7ff";
ctx.fillRect(x+3,y+6,1,1);
ctx.fillRect(x+6,y+6,1,1);

/* dress + shoes: now independently colored */
const dress = state.dressColor || ["#a64dff","#4dffcf","#ff4d88","#ffd24d"][state.outfit] || "#a64dff";
const shoes = state.shoeColor || "#ffffff";

/* dance pose (tiny pixel wiggle) */
const dancing = danceT>0;
const wob = dancing ? ((danceT%8<4)?1:0) : 0;

/* torso */
ctx.fillStyle=dress;
ctx.fillRect(x+2+wob,y+9,6,3);

/* shoes */
ctx.fillStyle=shoes;
ctx.fillRect(x+2-wob,y+12,2,1);
ctx.fillRect(x+6+wob,y+12,2,1);

/* arms (dance adds little swing) */
ctx.fillStyle="rgba(255,255,255,.05)";
if(dancing){
  ctx.fillRect(x+1,y+9,1,2);
  ctx.fillRect(x+8,y+9,1,2);
  ctx.fillStyle="rgba(138,46,255,.18)";
  ctx.fillRect(x+1,y+8,1,1);
  ctx.fillRect(x+8,y+8,1,1);
}else{
  ctx.fillRect(x+1,y+9,1,1);
  ctx.fillRect(x+8,y+9,1,1);
}

/* tiny aura while dancing */
if(dancing){
  ctx.fillStyle="rgba(138,46,255,.08)";
  ctx.fillRect(x-1,y+8,12,6);
}
}

function drawMilo(){
let x=milo.x,y=milo.y;
ctx.fillStyle="#d8d8d8";
ctx.fillRect(x+1,y+2,6,5);
ctx.fillRect(x+1,y+1,2,2);
ctx.fillRect(x+5,y+1,2,2);
ctx.fillStyle="#1affd3";
ctx.fillRect(x+2,y+4,1,1);
ctx.fillRect(x+5,y+4,1,1);
}

/* ---------- loop ---------- */
function loop(){
/* jump physics (visual only) */
if(!onGround){
  jumpV += 0.14;
  jumpZ += jumpV;
  if(jumpZ >= 0){
    jumpZ = 0;
    jumpV = 0;
    onGround = true;
  }
}

/* dance timer */
if(danceT>0) danceT--;

updateDust();

if(!state.slept){
let sp=keysDown.has("shift")?1.4:.9;
let dx=(keysDown.has("d")||keysDown.has("arrowright")?sp:0)-(keysDown.has("a")||keysDown.has("arrowleft")?sp:0);
let dy=(keysDown.has("s")||keysDown.has("arrowdown")?sp:0)-(keysDown.has("w")||keysDown.has("arrowup")?sp:0);
move(dx,dy);
}

/* NEW: when you get near something, we also show the name in the bottom toast (so you can’t miss it) */
const z=nearest();
showZoneToast(z);

/* interact */
if(keysDown.has("e")&&!loop.e){interact();loop.e=1;}
if(!keysDown.has("e"))loop.e=0;

/* jump: SPACE */
if((keysDown.has(" ")||keysDown.has("space")) && !loop.sp){
  doJump();
  loop.sp=1;
}
if(!(keysDown.has(" ")||keysDown.has("space"))) loop.sp=0;

/* dance: C */
if(keysDown.has("c") && !loop.c){
  doDance();
  loop.c=1;
}
if(!keysDown.has("c")) loop.c=0;

updateMilo();

state.sophia.x=sophia.x;
state.sophia.y=sophia.y;
state.milo.x=milo.x;
state.milo.y=milo.y;
save();

bg();
drawDust();
drawMilo();
drawSophia();

requestAnimationFrame(loop);
}
loop();

function go(f){save();location.href=f;}
</script>
</body>
</html>
